<!doctype html><html lang=ja dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  ボウリングゲーム
  #

最初の一歩ではウォーミングアップとしてFizzBuzzを書いてみました。
ここでは少しだけ難易度を上げたより実践的な例としてボウリングのスコア計算のプログラムを書いてみましょう。"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://onebase-fujitsu.github.io/agile-dev-guide/docs/softwaretest/bowlinggame/"><meta property="og:site_name" content="Fujitsu Agile Development Guide"><meta property="og:title" content="ボウリングゲーム"><meta property="og:description" content="ボウリングゲーム # 最初の一歩ではウォーミングアップとしてFizzBuzzを書いてみました。 ここでは少しだけ難易度を上げたより実践的な例としてボウリングのスコア計算のプログラムを書いてみましょう。"><meta property="og:locale" content="ja"><meta property="og:type" content="article"><meta property="article:section" content="docs"><title>ボウリングゲーム | Fujitsu Agile Development Guide</title>
<link rel=icon href=/agile-dev-guide/favicon.png><link rel=manifest href=/agile-dev-guide/manifest.json><link rel=canonical href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/softwaretest/bowlinggame/><link rel=stylesheet href=/agile-dev-guide/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/agile-dev-guide/><span>Fujitsu Agile Development Guide</span></a></h2><ul><li><a href=/agile-dev-guide/docs/introduction/>はじめに</a></li><li><input type=checkbox id=section-fe72557a7878dded4efa0060e21abacc class=toggle>
<label for=section-fe72557a7878dded4efa0060e21abacc class="flex justify-between"><a role=button>アジャイル</a></label><ul><li><a href=/agile-dev-guide/docs/agile/manifest/>アジャイルソフトウェア開発宣言</a></li><li><a href=/agile-dev-guide/docs/agile/principle/>アジャイル開発12の原則</a></li><li><a href=/agile-dev-guide/docs/agile/conclude/>まとめ</a></li></ul></li><li><input type=checkbox id=section-60906829343241fe59efbb09409d99f8 class=toggle>
<label for=section-60906829343241fe59efbb09409d99f8 class="flex justify-between"><a role=button>スクラム</a></label><ul><li><a href=/agile-dev-guide/docs/scrum/overview/>スクラムとは</a></li><li><a href=/agile-dev-guide/docs/scrum/roles/>ロール</a></li><li><a href=/agile-dev-guide/docs/scrum/products/>成果物</a></li><li><a href=/agile-dev-guide/docs/scrum/events/>イベント</a></li><li><a href=/agile-dev-guide/docs/scrum/conclude/>まとめ</a></li></ul></li><li><input type=checkbox id=section-8258873460fa80799dab8ced5b37f178 class=toggle>
<label for=section-8258873460fa80799dab8ced5b37f178 class="flex justify-between"><a role=button>エクストリームプログラミング</a></label><ul><li><a href=/agile-dev-guide/docs/xp/overview/>エクストリームプログラミングとは</a></li><li><a href=/agile-dev-guide/docs/xp/practice/>エクストリームプログラミングのプラクティス</a></li><li><a href=/agile-dev-guide/docs/xp/conclude/>まとめ</a></li></ul></li><li><input type=checkbox id=section-ef522355473a56c6b477dd934de57bb8 class=toggle checked>
<label for=section-ef522355473a56c6b477dd934de57bb8 class="flex justify-between"><a role=button>ソフトウェアテスト</a></label><ul><li><a href=/agile-dev-guide/docs/softwaretest/overview/>ソフトウェアテストを始めよう</a></li><li><a href=/agile-dev-guide/docs/softwaretest/fizzbuzz/>ウォーミングアップ</a></li><li><a href=/agile-dev-guide/docs/softwaretest/bowlinggame/ class=active>ボウリングゲーム</a></li><li><a href=/agile-dev-guide/docs/softwaretest/testdouble/>テストダブル</a></li><li><a href=/agile-dev-guide/docs/softwaretest/e2e/>E2Eテスト</a></li></ul></li><li><input type=checkbox id=section-c09385b1b773ce6e3a59f711992fc86e class=toggle>
<label for=section-c09385b1b773ce6e3a59f711992fc86e class="flex justify-between"><a role=button>ソフトウェア設計</a></label><ul><li><a href=/agile-dev-guide/docs/softwaredesign/about/>アジャイル開発に求められるソフトウェア設計</a></li><li><input type=checkbox id=section-af89c1e488b0f5f376cd7b5e25174bc5 class=toggle>
<label for=section-af89c1e488b0f5f376cd7b5e25174bc5 class="flex justify-between"><a role=button>SOLID原則</a></label><ul><li><a href=/agile-dev-guide/docs/softwaredesign/solidprinciple/srp/>単一責任の原則(SRP)</a></li><li><a href=/agile-dev-guide/docs/softwaredesign/solidprinciple/ocp/>オープン・クローズドの原則(OCP)</a></li><li><a href=/agile-dev-guide/docs/softwaredesign/solidprinciple/lsp/>リスコフの置換原則(LSP)</a></li><li><a href=/agile-dev-guide/docs/softwaredesign/solidprinciple/dip/>依存性逆転の原則(DIP)</a></li><li><a href=/agile-dev-guide/docs/softwaredesign/solidprinciple/isp/>インターフェース分離の原則(ISP)</a></li></ul></li><li><input type=checkbox id=section-866eec1f3dcfccd287cfe06fbdb82bb8 class=toggle>
<label for=section-866eec1f3dcfccd287cfe06fbdb82bb8 class="flex justify-between"><a role=button>デザインパターン</a></label><ul><li><a href=/agile-dev-guide/docs/softwaredesign/designpattern/designpattern/>デザインパターン</a></li></ul></li></ul></li><li><input type=checkbox id=section-ffa226df7ff6fdab04824ed978163e3a class=toggle>
<label for=section-ffa226df7ff6fdab04824ed978163e3a class="flex justify-between"><a role=button>アジャイルの実践</a></label><ul><li><a href=/agile-dev-guide/docs/practice/day1/>1日目</a></li><li><a href=/agile-dev-guide/docs/practice/day2/>2日目</a></li><li><a href=/agile-dev-guide/docs/practice/day3/>3日目</a></li><li><a href=/agile-dev-guide/docs/practice/day4/>4日目</a></li><li><a href=/agile-dev-guide/docs/practice/day5/>5日目</a></li><li><a href=/agile-dev-guide/docs/practice/day6/>6日目</a></li></ul></li><li><a href=/agile-dev-guide/docs/inclosing/>おわりに</a></li><li><a href=/agile-dev-guide/docs/recommendedbooks/>推奨書籍</a></li><li class=book-section-flat><span>全体編</span><ul><li><input type=checkbox id=section-c08c824050a314a836aa6f2a3533d6f4 class=toggle>
<label for=section-c08c824050a314a836aa6f2a3533d6f4 class="flex justify-between"><a role=button>リーンスタートアップアジャイル</a></label><ul><li><a href=/agile-dev-guide/docs/framework/leanstartup/overview/>リーンスタートアップアジャイルの流れ</a></li><li><a href=/agile-dev-guide/docs/framework/leanstartup/organization/>体制・役割</a></li><li><a href=/agile-dev-guide/docs/framework/leanstartup/productvision/>プロダクトビジョン / バリュープロポジション</a></li></ul></li><li><input type=checkbox id=section-4843f470e01d88c8920f705055d62d32 class=toggle>
<label for=section-4843f470e01d88c8920f705055d62d32 class="flex justify-between"><a role=button>モダナイゼーションアジャイル</a></label><ul><li><a href=/agile-dev-guide/docs/framework/modernization/overview/>モダナイゼーションアジャイルの流れ</a></li><li><a href=/agile-dev-guide/docs/framework/modernization/organization/>体制・役割</a></li><li><input type=checkbox id=section-16e7420deaec3bf622c47c912e4fe6b1 class=toggle>
<label for=section-16e7420deaec3bf622c47c912e4fe6b1 class="flex justify-between"><a role=button>Swift Method</a></label><ul><li><a href=/agile-dev-guide/docs/framework/modernization/swift/overview/>Swift Method とは</a></li><li><a href=/agile-dev-guide/docs/framework/modernization/swift/eventstorming/>Event Storming</a></li><li><a href=/agile-dev-guide/docs/framework/modernization/swift/boris/>Boris</a></li><li><a href=/agile-dev-guide/docs/framework/modernization/swift/snape/>SnapE</a></li><li><a href=/agile-dev-guide/docs/framework/modernization/swift/slices/>Slices</a></li><li><a href=/agile-dev-guide/docs/framework/modernization/swift/techchoice/>Tech Choice</a></li></ul></li></ul></li></ul></li><li class=book-section-flat><span>Team編</span><ul><li><a href=/agile-dev-guide/docs/team/workstyle/>チームの働き方</a></li><li><a href=/agile-dev-guide/docs/team/balancedteam/>バランスチーム</a></li><li><input type=checkbox id=section-a232289a72ea66e3aa7212c269a1f858 class=toggle>
<label for=section-a232289a72ea66e3aa7212c269a1f858 class="flex justify-between"><a role=button>マインドセット</a></label><ul><li><a href=/agile-dev-guide/docs/team/mindset/onebase/>ONEbaseの価値観</a></li><li><a href=/agile-dev-guide/docs/team/mindset/psychologicalsafety/>心理的安全性</a></li><li><a href=/agile-dev-guide/docs/team/mindset/xp/>XPの価値観</a></li><li><a href=/agile-dev-guide/docs/team/mindset/practice/>プラクティスの取り入れ方</a></li></ul></li><li><a href=/agile-dev-guide/docs/team/teambuilding/>チームビルディング</a></li><li><a href=/agile-dev-guide/docs/team/remotework/>リモートワーク</a></li><li><input type=checkbox id=section-110f9959d63e8c110b8745fc9d06c772 class=toggle>
<label for=section-110f9959d63e8c110b8745fc9d06c772 class="flex justify-between"><a role=button>チームのアクティビティ</a></label><ul><li><a href=/agile-dev-guide/docs/team/activities/officestandup/>全体スタンドアップ</a></li><li><a href=/agile-dev-guide/docs/team/activities/teamstandup/>チームスタンドアップ</a></li><li><a href=/agile-dev-guide/docs/team/activities/preipm/>Pre-IPM</a></li><li><a href=/agile-dev-guide/docs/team/activities/ipm/>IPM</a></li><li><a href=/agile-dev-guide/docs/team/activities/cl/>CLミーティング</a></li><li><a href=/agile-dev-guide/docs/team/activities/retro/>レトロスペクティブ</a></li><li><a href=/agile-dev-guide/docs/team/activities/salesmeeting/>営業確認会議</a></li><li><a href=/agile-dev-guide/docs/team/activities/internalsync/>Internal Sync</a></li><li><a href=/agile-dev-guide/docs/team/activities/riskmitigations/>Risks & Mitigations</a></li><li><a href=/agile-dev-guide/docs/team/activities/feedback/>フィードバック</a></li><li><a href=/agile-dev-guide/docs/team/activities/icebreak/>Ice Break</a></li><li><a href=/agile-dev-guide/docs/team/activities/teamhealthcheck/>Team Health Check</a></li><li><a href=/agile-dev-guide/docs/team/activities/1on1/>1on1</a></li><li><a href=/agile-dev-guide/docs/team/activities/exercise/>ラジオ体操</a></li></ul></li><li><input type=checkbox id=section-bdb63741ec425eaf58eeca20fa22f0f7 class=toggle>
<label for=section-bdb63741ec425eaf58eeca20fa22f0f7 class="flex justify-between"><a role=button>チームのプラクティス</a></label><ul><li><a href=/agile-dev-guide/docs/team/practices/facilitation/>ファシリテーション</a></li><li><a href=/agile-dev-guide/docs/team/practices/okrs/>OKRs</a></li></ul></li></ul></li><li class=book-section-flat><span>Designer編</span><ul><li><a href=/agile-dev-guide/docs/designer/overview/>Designerとは</a></li><li><input type=checkbox id=section-a01b867896ae9f1f3928ca93b2070a69 class=toggle>
<label for=section-a01b867896ae9f1f3928ca93b2070a69 class="flex justify-between"><a role=button>Designerのプラクティス</a></label><ul><li><a href=/agile-dev-guide/docs/designer/practices/persona/>ペルソナ</a></li><li><a href=/agile-dev-guide/docs/designer/practices/scenario/>シナリオ</a></li><li><a href=/agile-dev-guide/docs/designer/practices/researchplanning/>リサーチ計画立案</a></li><li><a href=/agile-dev-guide/docs/designer/practices/prototyping/>プロトタイピング</a></li><li><a href=/agile-dev-guide/docs/designer/practices/script/>スクリプト作成</a></li><li><a href=/agile-dev-guide/docs/designer/practices/researchaction/>リサーチ実施</a></li><li><a href=/agile-dev-guide/docs/designer/practices/synthesize/>シンセサイズ</a></li></ul></li></ul></li><li class=book-section-flat><span>Product Manager編</span><ul><li><a href=/agile-dev-guide/docs/productmanager/overview/>Product Managerとは</a></li><li><input type=checkbox id=section-d59afdd8070324cbcc7435686b4f2086 class=toggle>
<label for=section-d59afdd8070324cbcc7435686b4f2086 class="flex justify-between"><a role=button>Product Managerのプラクティス</a></label><ul><li><a href=/agile-dev-guide/docs/productmanager/practices/roadmap/>プロダクトロードマップ</a></li><li><a href=/agile-dev-guide/docs/productmanager/practices/mvp/>MVP</a></li><li><a href=/agile-dev-guide/docs/productmanager/practices/userstorymapping/>ユーザーストーリーマッピング</a></li><li><a href=/agile-dev-guide/docs/productmanager/practices/userstory/>ユーザーストーリー</a></li><li><a href=/agile-dev-guide/docs/productmanager/practices/2x2/>2×2</a></li></ul></li></ul></li><li class=book-section-flat><span>Developer編</span><ul><li><a href=/agile-dev-guide/docs/developer/overview/>Developerとは</a></li><li><input type=checkbox id=section-efb8318f4d88b390e60e256084f8f4ac class=toggle>
<label for=section-efb8318f4d88b390e60e256084f8f4ac class="flex justify-between"><a role=button>Developerのプラクティス</a></label><ul><li><a href=/agile-dev-guide/docs/developer/practices/tdd/>TDD</a></li><li><a href=/agile-dev-guide/docs/developer/practices/cicd/>CI/CD</a></li><li><a href=/agile-dev-guide/docs/developer/practices/pairprogramming/>ペアプログラミング</a></li><li><a href=/agile-dev-guide/docs/developer/practices/soroprogramming/>ソロプログラミング</a></li></ul></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/agile-dev-guide/svg/menu.svg class=book-icon alt=Menu></label><h3>ボウリングゲーム</h3><label for=toc-control><img src=/agile-dev-guide/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#ボウリングのルール>ボウリングのルール</a></li><li><a href=#プロジェクトの作成>プロジェクトの作成</a></li><li><a href=#ボウリングゲームの構造>ボウリングゲームの構造</a></li><li><a href=#frameクラス>Frameクラス</a><ul><li><a href=#最初のテスト>最初のテスト</a></li><li><a href=#最初の実装>最初の実装</a></li></ul></li><li><a href=#ストライクとスペアはどうする>ストライクとスペアはどうする？</a><ul><li><a href=#クラスの構造>クラスの構造</a></li><li><a href=#gameの最初のテスト>Gameの最初のテスト</a></li><li><a href=#gameの最初の実装>Gameの最初の実装</a></li><li><a href=#最後までゲームをやりきる>最後までゲームをやりきる</a></li><li><a href=#スペアのテスト>スペアのテスト</a></li><li><a href=#スペアの実装>スペアの実装</a></li><li><a href=#ストライクのテスト>ストライクのテスト</a></li><li><a href=#ストライクの実装>ストライクの実装</a></li></ul></li><li><a href=#テストを補完>テストを補完</a></li><li><a href=#完成>完成</a></li><li><a href=#kataとは>Kataとは？</a></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=ボウリングゲーム>ボウリングゲーム
<a class=anchor href=#%e3%83%9c%e3%82%a6%e3%83%aa%e3%83%b3%e3%82%b0%e3%82%b2%e3%83%bc%e3%83%a0>#</a></h1><p>最初の一歩ではウォーミングアップとしてFizzBuzzを書いてみました。
ここでは少しだけ難易度を上げたより実践的な例としてボウリングのスコア計算のプログラムを書いてみましょう。</p><p>これも <a href=http://butunclebob.com/ArticleS.UncleBob.TheBowlingGameKata>BowlingGameKata</a> というRobert C.Martinという著名なソフトウェア開発者が提唱されてる、
とても有名な問題です。ここではJavaで書いてみますが、お好きな言語で挑戦されてみてください。</p><p>もし途中でわからなくなったら <a href=#%e5%ae%8c%e6%88%90>完成</a> のセクションに完成したコードを公開してますので、
そちらを見てみてください。</p><h2 id=ボウリングのルール>ボウリングのルール
<a class=anchor href=#%e3%83%9c%e3%82%a6%e3%83%aa%e3%83%b3%e3%82%b0%e3%81%ae%e3%83%ab%e3%83%bc%e3%83%ab>#</a></h2><p>ボウリングのルールを知っているという方はここは読み飛ばしてもらって大丈夫です。</p><p>ボウリングはボールを10本のピンめがけて投げ、より多くのピンを倒すことを目的としたゲームです。
10フレームまであり、1フレームあたり最大2投して10本のピンをできるだけ多く倒します。</p><p>ボウリングのスコアは基本的には10フレーム目までに倒したピンの本数なのですが、いくつか特殊な条件があります。</p><p>各フレームの最初の投球で1度に10本すべて倒しきるとストライクになります。
ストライクを出すと倒した10点に加えて、次の2投分で倒したピンの本数がボーナスとして加算されます。
ストライクを出すとそのフレームは終わり2投目はありません。</p><p>また、各フレームの2投目で10本倒し切ると、スペアになります。
スペアを出すと倒した10点に加えて、次の1投で倒したピンの本数がボーナスとして加算されます。</p><p>最後の10フレーム目だけ特殊で10フレーム目でストライクを出すと追加で2投、スペアを出すと追加で1投することができます。
つまり、10フレーム目だけストライクかスペアを出すと3投することができ、出せなければ2投でおわります。</p><p>詳しくは <a href=http://www.tokibow.com/tbchp/score.htm>ボウリングのスコア計算</a> を見てみてください。</p><h2 id=プロジェクトの作成>プロジェクトの作成
<a class=anchor href=#%e3%83%97%e3%83%ad%e3%82%b8%e3%82%a7%e3%82%af%e3%83%88%e3%81%ae%e4%bd%9c%e6%88%90>#</a></h2><p>ここはFizzBuzzと同じです。プロジェクト名はBowlingGameにして新規Gradleプロジェクトを作ってください。</p><p><img src=newpj1.png alt=新規プロジェクト作成></p><p><img src=newpj2.png alt=新規プロジェクト作成></p><p><img src=newpj3.png alt=新規プロジェクト作成></p><h2 id=ボウリングゲームの構造>ボウリングゲームの構造
<a class=anchor href=#%e3%83%9c%e3%82%a6%e3%83%aa%e3%83%b3%e3%82%b0%e3%82%b2%e3%83%bc%e3%83%a0%e3%81%ae%e6%a7%8b%e9%80%a0>#</a></h2><p>まずボウリングのゲームをクラスで表現してみましょう。</p><script src=/agile-dev-guide/mermaid.min.js></script><script>mermaid.initialize({flowchart:{useMaxWidth:!0},theme:"default"})</script><pre class=mermaid>
classDiagram
Game "1" --> "10" Frame
Frame "1" --> "1..3" Throw
</pre><p>簡単なクラス図を書いてみました。ゲームは10のフレームオブジェクトからなり、
1フレームは1~3投のThrowオブジェクトからなりますね。</p><h2 id=frameクラス>Frameクラス
<a class=anchor href=#frame%e3%82%af%e3%83%a9%e3%82%b9>#</a></h2><h3 id=最初のテスト>最初のテスト
<a class=anchor href=#%e6%9c%80%e5%88%9d%e3%81%ae%e3%83%86%e3%82%b9%e3%83%88>#</a></h3><p>では最初のテストを書いてみましょう。
Throwクラスはどんな振る舞いを持つでしょうか？
プレイヤーが倒したピンの本数を保持するぐらいですね（つまりPOJOになる）。
単に本数を保持するだけであればこのクラスに"振る舞い"は特にないですね。
振る舞いがないのであれば、依存関係チェーンを１つ上がってFrameに着目して見ましょう。</p><p>フレームオブジェクトはスコアを保持していて、倒したピンの本数や、フレームがストライクだったとか、
スペアだったのかとを教えてくれるというようなメソッドがあるとなんとなく良さそうです。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// FrameTest.java</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.junit.jupiter.api.Test;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import static</span> org.assertj.core.api.AssertionsForClassTypes.assertThat;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>FrameTest</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>ピンを倒してなければそのフレームのスコアは0</span>() {
</span></span><span style=display:flex><span>        Frame f <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Frame();
</span></span><span style=display:flex><span>        assertThat(f.<span style=color:#a6e22e>getScore</span>()).<span style=color:#a6e22e>isEqualTo</span>(0);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>ピンを1回倒したらその本数がスコアになる</span>() {
</span></span><span style=display:flex><span>        Frame f <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Frame();
</span></span><span style=display:flex><span>        f.<span style=color:#a6e22e>add</span>(5);
</span></span><span style=display:flex><span>        assertThat(f.<span style=color:#a6e22e>getScore</span>()).<span style=color:#a6e22e>isEqualTo</span>(5);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>まずは単純に倒したピンの本数をスコアとして保持してくれるというテストを書いてみました。
この時点ではFrameクラスもadd()メソッドも、getScore()メソッドもないので当然失敗します。</p><h3 id=最初の実装>最初の実装
<a class=anchor href=#%e6%9c%80%e5%88%9d%e3%81%ae%e5%ae%9f%e8%a3%85>#</a></h3><p>これを満たす最小限の実装を考えてみましょう。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// Frame.java</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Frame</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>int</span> score <span style=color:#f92672>=</span> 0;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>getScore</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>score</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>add</span>(<span style=color:#66d9ef>int</span> pins) {
</span></span><span style=display:flex><span>        score <span style=color:#f92672>+=</span> pins;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>こんな漢字のFrame.javaを作ってみました。これでとりあえずテストは通りますね。</p><h2 id=ストライクとスペアはどうする>ストライクとスペアはどうする？
<a class=anchor href=#%e3%82%b9%e3%83%88%e3%83%a9%e3%82%a4%e3%82%af%e3%81%a8%e3%82%b9%e3%83%9a%e3%82%a2%e3%81%af%e3%81%a9%e3%81%86%e3%81%99%e3%82%8b>#</a></h2><h3 id=クラスの構造>クラスの構造
<a class=anchor href=#%e3%82%af%e3%83%a9%e3%82%b9%e3%81%ae%e6%a7%8b%e9%80%a0>#</a></h3><p>さて、Frameにスコアを保持することはできましたが、こうするとストライクやスペアのスコアをどうするかは難しい課題です。
異なるFrame同士をまとめるのはGameオブジェクトということになりますが、
GameはFrameに依存していて、FrameもまたGameに依存することになります。</p><pre class=mermaid>
classDiagram
    Game --> Frame
    Frame --> Game
    Frame --> Throw
</pre><p>クラス図で書くとこうなってしまいます。これはいただけないですね。GameとFrameが密結合になってしまっています。
これを解決する方法としてはFrameを連結リストにしてしまうという方法がありますね。
つまりFrameに前後のフレームへのポインタを保持しておいて、Frameのスコアを計算するときは、
後のフレームのピンの本数を連結リストを辿って取得するという方法ですね。</p><pre class=mermaid>
graph LR
    Frame1 --> Frame2
    Frame2 --> Frame3
    Frame3 --> Frame4
    Frame4 --> ...
</pre><p>こうすると、結構複雑なプログラムになりそうな気がしますね。
例えばストライクを3連続出したとすると、最初のフレームのFrameのスコアを計算するのに、
次のFrameを連結リストから辿って、そのFrameがストライクだったら、更に次のFrameを連結リストから辿って、
そのFrameの1投目のスコアを取ってきて&mldr;というロジックになります。</p><p>いったん、ここまでの作業を中断してGame側で投球を管理するようにしてみましょう。
もし、Gameを作業するなかでFrameの連結リストへの必要性が出てきたら、改めて考えてみることにしましょう。</p><h3 id=gameの最初のテスト>Gameの最初のテスト
<a class=anchor href=#game%e3%81%ae%e6%9c%80%e5%88%9d%e3%81%ae%e3%83%86%e3%82%b9%e3%83%88>#</a></h3><p>Gameのテストを書いてみました。といっても先のFrameのテストとやってることは変わりませんね。
テストのタイトルと、クラス名や変数名が変わっただけです。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// GameTest.java</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.junit.jupiter.api.Test;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import static</span> org.assertj.core.api.AssertionsForClassTypes.assertThat;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>GameTest</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>ピンを倒してなければゲームのスコアは0</span>() {
</span></span><span style=display:flex><span>        Game game <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Game();
</span></span><span style=display:flex><span>        assertThat(game.<span style=color:#a6e22e>getScore</span>()).<span style=color:#a6e22e>isEqualTo</span>(0);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>ピンを1回倒したらそれがゲームのスコアになる</span>() {
</span></span><span style=display:flex><span>        Game game <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Game();
</span></span><span style=display:flex><span>        game.<span style=color:#a6e22e>add</span>(5);
</span></span><span style=display:flex><span>        assertThat(game.<span style=color:#a6e22e>getScore</span>()).<span style=color:#a6e22e>isEqualTo</span>(5);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=gameの最初の実装>Gameの最初の実装
<a class=anchor href=#game%e3%81%ae%e6%9c%80%e5%88%9d%e3%81%ae%e5%ae%9f%e8%a3%85>#</a></h3><p>テストが失敗するのを確認したらGameクラスを実装してみます。これもFrameと同じですね。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// Game.java</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Game</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>int</span> score <span style=color:#f92672>=</span> 0;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>getScore</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>score</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>add</span>(<span style=color:#66d9ef>int</span> pins) {
</span></span><span style=display:flex><span>        score <span style=color:#f92672>+=</span> pins;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=最後までゲームをやりきる>最後までゲームをやりきる
<a class=anchor href=#%e6%9c%80%e5%be%8c%e3%81%be%e3%81%a7%e3%82%b2%e3%83%bc%e3%83%a0%e3%82%92%e3%82%84%e3%82%8a%e3%81%8d%e3%82%8b>#</a></h3><p>今のテストはボールを1回投げたテストしかありませんが、すでにボールを複数回投げることにも対応してそうですね。
テストを補強して最後までゲームをやりきってみましょう。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// GameTest.java</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.junit.jupiter.api.Test;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import static</span> org.assertj.core.api.AssertionsForClassTypes.assertThat;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>GameTest</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>すべて0本だったら最終スコアは0</span>() {
</span></span><span style=display:flex><span>        Game game <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Game();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> 0; i <span style=color:#f92672>&lt;</span> 20; i<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>            game.<span style=color:#a6e22e>add</span>(0);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        assertThat(game.<span style=color:#a6e22e>getScore</span>()).<span style=color:#a6e22e>isEqualTo</span>(0);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>ピンを毎回1本倒したらゲームのスコアは20</span>() {
</span></span><span style=display:flex><span>        Game game <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Game();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> 0; i <span style=color:#f92672>&lt;</span> 20; i<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>            game.<span style=color:#a6e22e>add</span>(1);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        assertThat(game.<span style=color:#a6e22e>getScore</span>()).<span style=color:#a6e22e>isEqualTo</span>(20);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>ボールを20回投げるようになりました。問題なくテストが通りますね。</p><h3 id=スペアのテスト>スペアのテスト
<a class=anchor href=#%e3%82%b9%e3%83%9a%e3%82%a2%e3%81%ae%e3%83%86%e3%82%b9%e3%83%88>#</a></h3><p>では早速スペアをやってみましょう。まずテストを書いてみます。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// GameTest.java</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.junit.jupiter.api.Test;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import static</span> org.assertj.core.api.AssertionsForClassTypes.assertThat;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>GameTest</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>すべて0本だったら最終スコアは0</span>() {
</span></span><span style=display:flex><span>        Game game <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Game();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> 0; i <span style=color:#f92672>&lt;</span> 20; i<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>            game.<span style=color:#a6e22e>add</span>(0);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        assertThat(game.<span style=color:#a6e22e>getScore</span>()).<span style=color:#a6e22e>isEqualTo</span>(0);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>ピンを毎回1本倒したらゲームのスコアは20</span>() {
</span></span><span style=display:flex><span>        Game game <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Game();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> 0; i <span style=color:#f92672>&lt;</span> 20; i<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>            game.<span style=color:#a6e22e>add</span>(1);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        assertThat(game.<span style=color:#a6e22e>getScore</span>()).<span style=color:#a6e22e>isEqualTo</span>(20);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>スペアを1回だすと次の投球がボーナスとして加算される</span>() {
</span></span><span style=display:flex><span>        Game game <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Game();
</span></span><span style=display:flex><span>        game.<span style=color:#a6e22e>add</span>(5);
</span></span><span style=display:flex><span>        game.<span style=color:#a6e22e>add</span>(5);
</span></span><span style=display:flex><span>        game.<span style=color:#a6e22e>add</span>(3);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> 0; i <span style=color:#f92672>&lt;</span> 17; i<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>            game.<span style=color:#a6e22e>add</span>(0);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        assertThat(game.<span style=color:#a6e22e>getScore</span>()).<span style=color:#a6e22e>isEqualTo</span>(16);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>テストとしてはこんな感じになります。
毎回Gameのインスタンスを作ったり、同じ投球をたくさん繰り返すのがちょっと大変になってきましたね。
また、Gameに対してaddするというメソッド名もチグハグな感じがします。
軽くリファクタリングしてみましょう。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// GameTest.java</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.junit.jupiter.api.BeforeEach;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.junit.jupiter.api.Test;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import static</span> org.assertj.core.api.AssertionsForClassTypes.assertThat;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>GameTest</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Game game;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@BeforeEach</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setUp</span>() {
</span></span><span style=display:flex><span>        game <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Game();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>rollsMany</span>(<span style=color:#66d9ef>int</span> times, <span style=color:#66d9ef>int</span> pins) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> 0; i <span style=color:#f92672>&lt;</span> times; i<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>            game.<span style=color:#a6e22e>roll</span>(pins);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>すべて0本だったら最終スコアは0</span>() {
</span></span><span style=display:flex><span>        rollsMany(20, 0);
</span></span><span style=display:flex><span>        assertThat(game.<span style=color:#a6e22e>getScore</span>()).<span style=color:#a6e22e>isEqualTo</span>(0);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>ピンを毎回1本倒したらゲームのスコアは20</span>() {
</span></span><span style=display:flex><span>        rollsMany(20, 1);
</span></span><span style=display:flex><span>        assertThat(game.<span style=color:#a6e22e>getScore</span>()).<span style=color:#a6e22e>isEqualTo</span>(20);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>スペアを1回だすと次の投球がボーナスとして加算される</span>() {
</span></span><span style=display:flex><span>        game.<span style=color:#a6e22e>roll</span>(5);
</span></span><span style=display:flex><span>        game.<span style=color:#a6e22e>roll</span>(5);
</span></span><span style=display:flex><span>        game.<span style=color:#a6e22e>roll</span>(3);
</span></span><span style=display:flex><span>        rollsMany(17, 0);
</span></span><span style=display:flex><span>        assertThat(game.<span style=color:#a6e22e>getScore</span>()).<span style=color:#a6e22e>isEqualTo</span>(16);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>テストをこのように変更してみました。
add()メソッドはroll()メソッドに名前を変更しました。
また、rollsManyというプライベート関数を使って簡単にたくさん投球ができるようにしました。
さらに@BeforeEachでテストの前にGameのインスタンスを作るという書き方にしてみました。</p><p>これでテストを実行すると最後のスペアのテストだけ失敗します。
早速これを実装してみましょう。</p><h3 id=スペアの実装>スペアの実装
<a class=anchor href=#%e3%82%b9%e3%83%9a%e3%82%a2%e3%81%ae%e5%ae%9f%e8%a3%85>#</a></h3><p>今、Gameの実装はこの様になってます。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// Game.java</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Game</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>int</span> score <span style=color:#f92672>=</span> 0;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>getScore</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>score</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>roll</span>(<span style=color:#66d9ef>int</span> pins) {
</span></span><span style=display:flex><span>        score <span style=color:#f92672>+=</span> pins;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>よくよく見てみると、roll()がスコアの計算をしていて、名前にあってませんね。
さらにgetScore()はスコアを取得するところですが、本来はここでスコアを計算すべきなように見えます。
ちょっとここでGameクラスについてもリファクタリングしてみましょう。</p><p>いったん、スペアのテストをコメントアウトします。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// GameTest.java</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.junit.jupiter.api.BeforeEach;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.junit.jupiter.api.Test;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import static</span> org.assertj.core.api.AssertionsForClassTypes.assertThat;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>GameTest</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Game game;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@BeforeEach</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setUp</span>() {
</span></span><span style=display:flex><span>        game <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Game();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>rollsMany</span>(<span style=color:#66d9ef>int</span> times, <span style=color:#66d9ef>int</span> pins) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> 0; i <span style=color:#f92672>&lt;</span> times; i<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>            game.<span style=color:#a6e22e>roll</span>(pins);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>すべて0本だったら最終スコアは0</span>() {
</span></span><span style=display:flex><span>        rollsMany(20, 0);
</span></span><span style=display:flex><span>        assertThat(game.<span style=color:#a6e22e>getScore</span>()).<span style=color:#a6e22e>isEqualTo</span>(0);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>ピンを毎回1本倒したらゲームのスコアは20</span>() {
</span></span><span style=display:flex><span>        rollsMany(20, 1);
</span></span><span style=display:flex><span>        assertThat(game.<span style=color:#a6e22e>getScore</span>()).<span style=color:#a6e22e>isEqualTo</span>(20);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>//    @Test</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//    public void スペアを1回だすと次の投球がボーナスとして加算される() {</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//        game.roll(5);</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//        game.roll(5);</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//        game.roll(3);</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//        rollsMany(17, 0);</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//        assertThat(game.getScore()).isEqualTo(16);</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//    }</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>ではGameをリファクタリングしてみましょう。
これを修正するためにはroll()を純粋に倒したピンの本数を記録するためのメソッドにしてしまって、
getScore()でスコアの計算をするように変更すると良さそうですね。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// Game.java</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Game</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span><span style=color:#f92672>[]</span> rolls <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#66d9ef>int</span><span style=color:#f92672>[</span>21<span style=color:#f92672>]</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>int</span> currentRoll <span style=color:#f92672>=</span> 0;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>getScore</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span> score <span style=color:#f92672>=</span> 0;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> 0; i <span style=color:#f92672>&lt;</span> rolls.<span style=color:#a6e22e>length</span>; i<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>            score <span style=color:#f92672>+=</span> rolls<span style=color:#f92672>[</span>i<span style=color:#f92672>]</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> score;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>roll</span>(<span style=color:#66d9ef>int</span> pins) {
</span></span><span style=display:flex><span>        rolls<span style=color:#f92672>[</span>currentRoll<span style=color:#f92672>++]</span> <span style=color:#f92672>=</span> pins;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>できましたね。元あったテストはパスしましたし、スペアのテストのコメントアウトを外しましょう。
では早速、スペアの実装に入ってみましょう。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// Game.java</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Game</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span><span style=color:#f92672>[]</span> rolls <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#66d9ef>int</span><span style=color:#f92672>[</span>21<span style=color:#f92672>]</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>int</span> currentRoll <span style=color:#f92672>=</span> 0;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>getScore</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span> score <span style=color:#f92672>=</span> 0;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> 0; i <span style=color:#f92672>&lt;</span> rolls.<span style=color:#a6e22e>length</span>; i<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (rolls<span style=color:#f92672>[</span>i<span style=color:#f92672>]</span> <span style=color:#f92672>+</span> rolls<span style=color:#f92672>[</span>i<span style=color:#f92672>+</span>1<span style=color:#f92672>]</span> <span style=color:#f92672>==</span> 10) { <span style=color:#75715e>// spare</span>
</span></span><span style=display:flex><span>                score <span style=color:#f92672>+=</span> rolls<span style=color:#f92672>[</span>i<span style=color:#f92672>+</span>1<span style=color:#f92672>]</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            score <span style=color:#f92672>+=</span> rolls<span style=color:#f92672>[</span>i<span style=color:#f92672>]</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> score;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>roll</span>(<span style=color:#66d9ef>int</span> pins) {
</span></span><span style=display:flex><span>        rolls<span style=color:#f92672>[</span>currentRoll<span style=color:#f92672>++]</span> <span style=color:#f92672>=</span> pins;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>まずこんな処理を書いてみました。一見すると良さそうな気がしますね。
でもこのように書いてしまうと、例えば1フレーム目の2投目と2フレーム目の1投目が合計10だと、スペアの判定になってしまいます。
それは実装したい処理ではありませんよね。
ストライクやスペアの実装にはフレームの概念が必要だということが分かります。</p><p>再びリファクタリングしてみましょう。また、スペアを確認するテストをコメントアウトしてください。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// Game.java</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Game</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span><span style=color:#f92672>[]</span> rolls <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#66d9ef>int</span><span style=color:#f92672>[</span>21<span style=color:#f92672>]</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>int</span> currentRoll <span style=color:#f92672>=</span> 0;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>getScore</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span> score <span style=color:#f92672>=</span> 0;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> 0;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> frame <span style=color:#f92672>=</span> 0; frame <span style=color:#f92672>&lt;</span> 10; frame<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>            score <span style=color:#f92672>+=</span> rolls<span style=color:#f92672>[</span>i<span style=color:#f92672>]</span> <span style=color:#f92672>+</span> rolls<span style=color:#f92672>[</span>i<span style=color:#f92672>+</span>1<span style=color:#f92672>]</span>;
</span></span><span style=display:flex><span>            i <span style=color:#f92672>+=</span> 2;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> score;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>roll</span>(<span style=color:#66d9ef>int</span> pins) {
</span></span><span style=display:flex><span>        rolls<span style=color:#f92672>[</span>currentRoll<span style=color:#f92672>++]</span> <span style=color:#f92672>=</span> pins;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>getScore()メソッドの実装をこのようにしてみました。
iという各フレームの1投目の位置を保持する変数を作ってみました。
各フレームのスコアはi番目の倒した本数と、i+1番目の倒した本数の合計になりますね。</p><p>これで元々のテストはパスしましたので、再度スペアの実装に挑んでみましょう。スペアを確認するテストのコメントアウトを外してください。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// Game.java</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Game</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span><span style=color:#f92672>[]</span> rolls <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#66d9ef>int</span><span style=color:#f92672>[</span>21<span style=color:#f92672>]</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>int</span> currentRoll <span style=color:#f92672>=</span> 0;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>getScore</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span> score <span style=color:#f92672>=</span> 0;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> 0;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> frame <span style=color:#f92672>=</span> 0; frame <span style=color:#f92672>&lt;</span> 10; frame<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (rolls<span style=color:#f92672>[</span>i<span style=color:#f92672>]</span> <span style=color:#f92672>+</span> rolls<span style=color:#f92672>[</span>i <span style=color:#f92672>+</span> 1<span style=color:#f92672>]</span> <span style=color:#f92672>==</span> 10) { <span style=color:#75715e>// spare</span>
</span></span><span style=display:flex><span>                score <span style=color:#f92672>+=</span> 10 <span style=color:#f92672>+</span> rolls<span style=color:#f92672>[</span>i <span style=color:#f92672>+</span> 2<span style=color:#f92672>]</span>;
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                score <span style=color:#f92672>+=</span> rolls<span style=color:#f92672>[</span>i<span style=color:#f92672>]</span> <span style=color:#f92672>+</span> rolls<span style=color:#f92672>[</span>i <span style=color:#f92672>+</span> 1<span style=color:#f92672>]</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            i <span style=color:#f92672>+=</span> 2;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> score;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>roll</span>(<span style=color:#66d9ef>int</span> pins) {
</span></span><span style=display:flex><span>        rolls<span style=color:#f92672>[</span>currentRoll<span style=color:#f92672>++]</span> <span style=color:#f92672>=</span> pins;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>getScore()をこのような実装にしてみました。
スペアのときはi番目の次の次の配列を参照して加算するというふうにしてみました。</p><p>これでスペアの計算ができましたね！テストもパスすることができました！！
スペアの実装はこれで終わりでしょうか？</p><p>iという変数名はこの関数を書いていない人が見たときに何の役割を担ってる変数なのかパッと見でわからないですし、
spareを判定するところにコメントがありますが、そもそもコメントがないと読めないような処理というのは微妙ですよね。
ということでリファクタリングをしてみましょう。</p><p>まずiをわかりやすい別の名前にします。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// Game.java</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Game</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span><span style=color:#f92672>[]</span> rolls <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#66d9ef>int</span><span style=color:#f92672>[</span>21<span style=color:#f92672>]</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>int</span> currentRoll <span style=color:#f92672>=</span> 0;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>getScore</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span> score <span style=color:#f92672>=</span> 0;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span> frameIndex <span style=color:#f92672>=</span> 0;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> frame <span style=color:#f92672>=</span> 0; frame <span style=color:#f92672>&lt;</span> 10; frame<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (rolls<span style=color:#f92672>[</span>frameIndex<span style=color:#f92672>]</span> <span style=color:#f92672>+</span> rolls<span style=color:#f92672>[</span>frameIndex <span style=color:#f92672>+</span> 1<span style=color:#f92672>]</span> <span style=color:#f92672>==</span> 10) { <span style=color:#75715e>// spare</span>
</span></span><span style=display:flex><span>                score <span style=color:#f92672>+=</span> 10 <span style=color:#f92672>+</span> rolls<span style=color:#f92672>[</span>frameIndex <span style=color:#f92672>+</span> 2<span style=color:#f92672>]</span>;
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                score <span style=color:#f92672>+=</span> rolls<span style=color:#f92672>[</span>frameIndex<span style=color:#f92672>]</span> <span style=color:#f92672>+</span> rolls<span style=color:#f92672>[</span>frameIndex <span style=color:#f92672>+</span> 1<span style=color:#f92672>]</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            frameIndex <span style=color:#f92672>+=</span> 2;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> score;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>roll</span>(<span style=color:#66d9ef>int</span> pins) {
</span></span><span style=display:flex><span>        rolls<span style=color:#f92672>[</span>currentRoll<span style=color:#f92672>++]</span> <span style=color:#f92672>=</span> pins;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>frameIndexという名前に変わりました。スペアの判定はどうしましょうか？
ここではisSpare()のようなboolean値を返すプライベートメソッドを作ると良さそうですね。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// Game.java</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Game</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span><span style=color:#f92672>[]</span> rolls <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#66d9ef>int</span><span style=color:#f92672>[</span>21<span style=color:#f92672>]</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>int</span> currentRoll <span style=color:#f92672>=</span> 0;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>getScore</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span> score <span style=color:#f92672>=</span> 0;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span> frameIndex <span style=color:#f92672>=</span> 0;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> frame <span style=color:#f92672>=</span> 0; frame <span style=color:#f92672>&lt;</span> 10; frame<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (isSpare(frameIndex)) {
</span></span><span style=display:flex><span>                score <span style=color:#f92672>+=</span> 10 <span style=color:#f92672>+</span> rolls<span style=color:#f92672>[</span>frameIndex <span style=color:#f92672>+</span> 2<span style=color:#f92672>]</span>;
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                score <span style=color:#f92672>+=</span> rolls<span style=color:#f92672>[</span>frameIndex<span style=color:#f92672>]</span> <span style=color:#f92672>+</span> rolls<span style=color:#f92672>[</span>frameIndex <span style=color:#f92672>+</span> 1<span style=color:#f92672>]</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            frameIndex <span style=color:#f92672>+=</span> 2;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> score;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>roll</span>(<span style=color:#66d9ef>int</span> pins) {
</span></span><span style=display:flex><span>        rolls<span style=color:#f92672>[</span>currentRoll<span style=color:#f92672>++]</span> <span style=color:#f92672>=</span> pins;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>isSpare</span>(<span style=color:#66d9ef>int</span> frameIndex) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> rolls<span style=color:#f92672>[</span>frameIndex<span style=color:#f92672>]</span> <span style=color:#f92672>+</span> rolls<span style=color:#f92672>[</span>frameIndex<span style=color:#f92672>]</span> <span style=color:#f92672>==</span> 10;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>このようにしてみました。変数名もわかりやすくなりましたし、スペアを取ったときの処理分岐もひと目で分かるようになりました！</p><p>ここまで来ると、Frameの連結リストにしなくてもなんとなくGameでスコアを保持しておけば実装できそうだという目星がつきますよね。
Frame.javaとFrameTest.javaは消しちゃいましょう。</p><h3 id=ストライクのテスト>ストライクのテスト
<a class=anchor href=#%e3%82%b9%e3%83%88%e3%83%a9%e3%82%a4%e3%82%af%e3%81%ae%e3%83%86%e3%82%b9%e3%83%88>#</a></h3><p>では今度はストライクのテストを書いてみましょう。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// GameTest.java</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.junit.jupiter.api.BeforeEach;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.junit.jupiter.api.Test;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import static</span> org.assertj.core.api.AssertionsForClassTypes.assertThat;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>GameTest</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Game game;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@BeforeEach</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setUp</span>() {
</span></span><span style=display:flex><span>        game <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Game();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>rollsMany</span>(<span style=color:#66d9ef>int</span> times, <span style=color:#66d9ef>int</span> pins) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> 0; i <span style=color:#f92672>&lt;</span> times; i<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>            game.<span style=color:#a6e22e>roll</span>(pins);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>すべて0本だったら最終スコアは0</span>() {
</span></span><span style=display:flex><span>        rollsMany(20, 0);
</span></span><span style=display:flex><span>        assertThat(game.<span style=color:#a6e22e>getScore</span>()).<span style=color:#a6e22e>isEqualTo</span>(0);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>ピンを毎回1本倒したらゲームのスコアは20</span>() {
</span></span><span style=display:flex><span>        rollsMany(20, 1);
</span></span><span style=display:flex><span>        assertThat(game.<span style=color:#a6e22e>getScore</span>()).<span style=color:#a6e22e>isEqualTo</span>(20);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>スペアを1回だすと次の投球がボーナスとして加算される</span>() {
</span></span><span style=display:flex><span>        game.<span style=color:#a6e22e>roll</span>(5);
</span></span><span style=display:flex><span>        game.<span style=color:#a6e22e>roll</span>(5);
</span></span><span style=display:flex><span>        game.<span style=color:#a6e22e>roll</span>(3);
</span></span><span style=display:flex><span>        rollsMany(17, 0);
</span></span><span style=display:flex><span>        assertThat(game.<span style=color:#a6e22e>getScore</span>()).<span style=color:#a6e22e>isEqualTo</span>(16);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>ストライクを1回出すと次の投球と更に次の投球がボーナスとして加算される</span>() {
</span></span><span style=display:flex><span>        game.<span style=color:#a6e22e>roll</span>(10);
</span></span><span style=display:flex><span>        game.<span style=color:#a6e22e>roll</span>(3);
</span></span><span style=display:flex><span>        game.<span style=color:#a6e22e>roll</span>(4);
</span></span><span style=display:flex><span>        rollsMany(16, 0);
</span></span><span style=display:flex><span>        assertThat(game.<span style=color:#a6e22e>getScore</span>()).<span style=color:#a6e22e>isEqualTo</span>(24);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>こんな感じにしてみました。こうしてみると、</p><pre tabindex=0><code>game.roll(5);
game.roll(5);
</code></pre><p>がスペアを意味していたり、</p><pre tabindex=0><code>game.roll(10);
</code></pre><p>がストライクを意味しているというのは少しソースコードからは読み取りづらいですね。ここもリファクタリングしてみましょう。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>import</span> org.junit.jupiter.api.BeforeEach;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.junit.jupiter.api.Test;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import static</span> org.assertj.core.api.AssertionsForClassTypes.assertThat;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>GameTest</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Game game;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@BeforeEach</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setUp</span>() {
</span></span><span style=display:flex><span>        game <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Game();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>rollsMany</span>(<span style=color:#66d9ef>int</span> times, <span style=color:#66d9ef>int</span> pins) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> 0; i <span style=color:#f92672>&lt;</span> times; i<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>            game.<span style=color:#a6e22e>roll</span>(pins);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>rollSpare</span>() {
</span></span><span style=display:flex><span>        game.<span style=color:#a6e22e>roll</span>(5);
</span></span><span style=display:flex><span>        game.<span style=color:#a6e22e>roll</span>(5);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>rollStrike</span>() {
</span></span><span style=display:flex><span>        game.<span style=color:#a6e22e>roll</span>(10);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>すべて0本だったら最終スコアは0</span>() {
</span></span><span style=display:flex><span>        rollsMany(20, 0);
</span></span><span style=display:flex><span>        assertThat(game.<span style=color:#a6e22e>getScore</span>()).<span style=color:#a6e22e>isEqualTo</span>(0);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>ピンを毎回1本倒したらゲームのスコアは20</span>() {
</span></span><span style=display:flex><span>        rollsMany(20, 1);
</span></span><span style=display:flex><span>        assertThat(game.<span style=color:#a6e22e>getScore</span>()).<span style=color:#a6e22e>isEqualTo</span>(20);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>スペアを1回だすと次の投球がボーナスとして加算される</span>() {
</span></span><span style=display:flex><span>        rollSpare();
</span></span><span style=display:flex><span>        game.<span style=color:#a6e22e>roll</span>(3);
</span></span><span style=display:flex><span>        rollsMany(17, 0);
</span></span><span style=display:flex><span>        assertThat(game.<span style=color:#a6e22e>getScore</span>()).<span style=color:#a6e22e>isEqualTo</span>(16);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>ストライクを1回出すと次の投球と更に次の投球がボーナスとして加算される</span>() {
</span></span><span style=display:flex><span>        rollStrike();
</span></span><span style=display:flex><span>        game.<span style=color:#a6e22e>roll</span>(3);
</span></span><span style=display:flex><span>        game.<span style=color:#a6e22e>roll</span>(4);
</span></span><span style=display:flex><span>        rollsMany(16, 0);
</span></span><span style=display:flex><span>        assertThat(game.<span style=color:#a6e22e>getScore</span>()).<span style=color:#a6e22e>isEqualTo</span>(24);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>こうすると良さそうですね。では早速実装してみましょう。</p><h3 id=ストライクの実装>ストライクの実装
<a class=anchor href=#%e3%82%b9%e3%83%88%e3%83%a9%e3%82%a4%e3%82%af%e3%81%ae%e5%ae%9f%e8%a3%85>#</a></h3><p>スペアができたので、ストライクも同じように実装できそうですよね。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// Game.java</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Game</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span><span style=color:#f92672>[]</span> rolls <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#66d9ef>int</span><span style=color:#f92672>[</span>21<span style=color:#f92672>]</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>int</span> currentRoll <span style=color:#f92672>=</span> 0;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>getScore</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span> score <span style=color:#f92672>=</span> 0;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span> frameIndex <span style=color:#f92672>=</span> 0;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> frame <span style=color:#f92672>=</span> 0; frame <span style=color:#f92672>&lt;</span> 10; frame<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (rolls<span style=color:#f92672>[</span>frameIndex<span style=color:#f92672>]</span> <span style=color:#f92672>==</span> 10) { <span style=color:#75715e>// Strike</span>
</span></span><span style=display:flex><span>                score <span style=color:#f92672>+=</span> 10 <span style=color:#f92672>+</span> rolls<span style=color:#f92672>[</span>frameIndex<span style=color:#f92672>+</span>1<span style=color:#f92672>]</span> <span style=color:#f92672>+</span> rolls<span style=color:#f92672>[</span>frameIndex<span style=color:#f92672>+</span>2<span style=color:#f92672>]</span>;
</span></span><span style=display:flex><span>                frameIndex <span style=color:#f92672>+=</span> 1;
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (isSpare(frameIndex)) {
</span></span><span style=display:flex><span>                score <span style=color:#f92672>+=</span> 10 <span style=color:#f92672>+</span> rolls<span style=color:#f92672>[</span>frameIndex <span style=color:#f92672>+</span> 2<span style=color:#f92672>]</span>;
</span></span><span style=display:flex><span>                frameIndex <span style=color:#f92672>+=</span> 2;
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                score <span style=color:#f92672>+=</span> rolls<span style=color:#f92672>[</span>frameIndex<span style=color:#f92672>]</span> <span style=color:#f92672>+</span> rolls<span style=color:#f92672>[</span>frameIndex <span style=color:#f92672>+</span> 1<span style=color:#f92672>]</span>;
</span></span><span style=display:flex><span>                frameIndex <span style=color:#f92672>+=</span> 2;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> score;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>roll</span>(<span style=color:#66d9ef>int</span> pins) {
</span></span><span style=display:flex><span>        rolls<span style=color:#f92672>[</span>currentRoll<span style=color:#f92672>++]</span> <span style=color:#f92672>=</span> pins;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>isSpare</span>(<span style=color:#66d9ef>int</span> frameIndex) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> rolls<span style=color:#f92672>[</span>frameIndex<span style=color:#f92672>]</span> <span style=color:#f92672>+</span> rolls<span style=color:#f92672>[</span>frameIndex<span style=color:#f92672>]</span> <span style=color:#f92672>==</span> 10;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>こんな感じで実装できました。テストもパスできましたね。
これもストライクの判定処理を切り出すリファクタリングをやってみましょう。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Game</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span><span style=color:#f92672>[]</span> rolls <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#66d9ef>int</span><span style=color:#f92672>[</span>21<span style=color:#f92672>]</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>int</span> currentRoll <span style=color:#f92672>=</span> 0;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>getScore</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span> score <span style=color:#f92672>=</span> 0;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span> frameIndex <span style=color:#f92672>=</span> 0;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> frame <span style=color:#f92672>=</span> 0; frame <span style=color:#f92672>&lt;</span> 10; frame<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (isStrike(frameIndex)) {
</span></span><span style=display:flex><span>                score <span style=color:#f92672>+=</span> 10 <span style=color:#f92672>+</span> rolls<span style=color:#f92672>[</span>frameIndex <span style=color:#f92672>+</span> 1<span style=color:#f92672>]</span> <span style=color:#f92672>+</span> rolls<span style=color:#f92672>[</span>frameIndex <span style=color:#f92672>+</span> 2<span style=color:#f92672>]</span>;
</span></span><span style=display:flex><span>                frameIndex <span style=color:#f92672>+=</span> 1;
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (isSpare(frameIndex)) {
</span></span><span style=display:flex><span>                score <span style=color:#f92672>+=</span> 10 <span style=color:#f92672>+</span> rolls<span style=color:#f92672>[</span>frameIndex <span style=color:#f92672>+</span> 2<span style=color:#f92672>]</span>;
</span></span><span style=display:flex><span>                frameIndex <span style=color:#f92672>+=</span> 2;
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                score <span style=color:#f92672>+=</span> rolls<span style=color:#f92672>[</span>frameIndex<span style=color:#f92672>]</span> <span style=color:#f92672>+</span> rolls<span style=color:#f92672>[</span>frameIndex <span style=color:#f92672>+</span> 1<span style=color:#f92672>]</span>;
</span></span><span style=display:flex><span>                frameIndex <span style=color:#f92672>+=</span> 2;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> score;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>roll</span>(<span style=color:#66d9ef>int</span> pins) {
</span></span><span style=display:flex><span>        rolls<span style=color:#f92672>[</span>currentRoll<span style=color:#f92672>++]</span> <span style=color:#f92672>=</span> pins;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>isSpare</span>(<span style=color:#66d9ef>int</span> frameIndex) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> rolls<span style=color:#f92672>[</span>frameIndex<span style=color:#f92672>]</span> <span style=color:#f92672>+</span> rolls<span style=color:#f92672>[</span>frameIndex<span style=color:#f92672>]</span> <span style=color:#f92672>==</span> 10;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>isStrike</span>(<span style=color:#66d9ef>int</span> frameIndex) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> rolls<span style=color:#f92672>[</span>frameIndex<span style=color:#f92672>]</span> <span style=color:#f92672>==</span> 10;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>良さそうですね。最後の仕上げをしていきましょう。</p><h2 id=テストを補完>テストを補完
<a class=anchor href=#%e3%83%86%e3%82%b9%e3%83%88%e3%82%92%e8%a3%9c%e5%ae%8c>#</a></h2><p>ストライクを1回とるテストとスペアを1回とるテストはできました。
複数回とるテストがありませんので、これを書いてみましょう。</p><p>ボウリングはスコアの上限が300であることが知られていますので、これを確認するテストを追加しましょう。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// GameTest.java</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.junit.jupiter.api.BeforeEach;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.junit.jupiter.api.Test;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import static</span> org.assertj.core.api.AssertionsForClassTypes.assertThat;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>GameTest</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Game game;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@BeforeEach</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setUp</span>() {
</span></span><span style=display:flex><span>        game <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Game();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>rollsMany</span>(<span style=color:#66d9ef>int</span> times, <span style=color:#66d9ef>int</span> pins) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> 0; i <span style=color:#f92672>&lt;</span> times; i<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>            game.<span style=color:#a6e22e>roll</span>(pins);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>rollSpare</span>() {
</span></span><span style=display:flex><span>        game.<span style=color:#a6e22e>roll</span>(5);
</span></span><span style=display:flex><span>        game.<span style=color:#a6e22e>roll</span>(5);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>rollStrike</span>() {
</span></span><span style=display:flex><span>        game.<span style=color:#a6e22e>roll</span>(10);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>すべて0本だったら最終スコアは0</span>() {
</span></span><span style=display:flex><span>        rollsMany(20, 0);
</span></span><span style=display:flex><span>        assertThat(game.<span style=color:#a6e22e>getScore</span>()).<span style=color:#a6e22e>isEqualTo</span>(0);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>ピンを毎回1本倒したらゲームのスコアは20</span>() {
</span></span><span style=display:flex><span>        rollsMany(20, 1);
</span></span><span style=display:flex><span>        assertThat(game.<span style=color:#a6e22e>getScore</span>()).<span style=color:#a6e22e>isEqualTo</span>(20);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>スペアを1回だすと次の投球がボーナスとして加算される</span>() {
</span></span><span style=display:flex><span>        rollSpare();
</span></span><span style=display:flex><span>        game.<span style=color:#a6e22e>roll</span>(3);
</span></span><span style=display:flex><span>        rollsMany(17, 0);
</span></span><span style=display:flex><span>        assertThat(game.<span style=color:#a6e22e>getScore</span>()).<span style=color:#a6e22e>isEqualTo</span>(16);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>ストライクを1回出すと次の投球と更に次の投球がボーナスとして加算される</span>() {
</span></span><span style=display:flex><span>        rollStrike();
</span></span><span style=display:flex><span>        game.<span style=color:#a6e22e>roll</span>(3);
</span></span><span style=display:flex><span>        game.<span style=color:#a6e22e>roll</span>(4);
</span></span><span style=display:flex><span>        rollsMany(16, 0);
</span></span><span style=display:flex><span>        assertThat(game.<span style=color:#a6e22e>getScore</span>()).<span style=color:#a6e22e>isEqualTo</span>(24);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>すべてストライクを出すとスコアが300になる</span>() {
</span></span><span style=display:flex><span>        rollsMany(12, 10);
</span></span><span style=display:flex><span>        assertThat(game.<span style=color:#a6e22e>getScore</span>()).<span style=color:#a6e22e>isEqualTo</span>(300);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>もう実装はすでに連続ストライクや連続スペアに対応できてるので、テストはそのままパスします。</p><h2 id=完成>完成
<a class=anchor href=#%e5%ae%8c%e6%88%90>#</a></h2><p>これでボウリングのスコア計算のプログラムは完成しましたね！おめでとうございます！！
完成したソースコードを <a href=https://github.com/Onebase-Fujitsu/bowlingGameKata>こちらで公開しています</a> 。
もしわからなくなったら参照してみてください。</p><hr><h2 id=kataとは>Kataとは？
<a class=anchor href=#kata%e3%81%a8%e3%81%af>#</a></h2><p>どうでしたでしょうか。テスト駆動開発でプログラムを作る流れは分かりましたでしょうか？
さてこの問題は「BowlingGameKata」という有名な問題だという話は冒頭でしました。
この「Kata」ってなんでしょう？</p><p>そうこれは空手や柔道の「形」からきています。
プログラミングのお作法は1度やったらすぐに身につくというものではありません。
何度も何度もやって体になじませていくのが大事です。</p><p>BowlingGameKataはテスト駆動開発の形として有名な問題です。
他にも有名なKataとして <a href=http://codekata.com/>CodeKata</a> があります。
様々なプログラミングの練習問題がここには掲載されています。</p><p>時間を見つけて取り組んでみるといいでしょう。仲間を見つけて一緒にやってみるのもいいかもしれません。
同じ型でも繰り返すことで自分のプログラミングスキルの向上していることが体感できるはずです。</p><hr><p>次にテストダブルについて学んでみましょう。</p><p><a href=/agile-dev-guide/docs/softwaretest/testdouble/ class=book-btn>テストダブル</a></p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#ボウリングのルール>ボウリングのルール</a></li><li><a href=#プロジェクトの作成>プロジェクトの作成</a></li><li><a href=#ボウリングゲームの構造>ボウリングゲームの構造</a></li><li><a href=#frameクラス>Frameクラス</a><ul><li><a href=#最初のテスト>最初のテスト</a></li><li><a href=#最初の実装>最初の実装</a></li></ul></li><li><a href=#ストライクとスペアはどうする>ストライクとスペアはどうする？</a><ul><li><a href=#クラスの構造>クラスの構造</a></li><li><a href=#gameの最初のテスト>Gameの最初のテスト</a></li><li><a href=#gameの最初の実装>Gameの最初の実装</a></li><li><a href=#最後までゲームをやりきる>最後までゲームをやりきる</a></li><li><a href=#スペアのテスト>スペアのテスト</a></li><li><a href=#スペアの実装>スペアの実装</a></li><li><a href=#ストライクのテスト>ストライクのテスト</a></li><li><a href=#ストライクの実装>ストライクの実装</a></li></ul></li><li><a href=#テストを補完>テストを補完</a></li><li><a href=#完成>完成</a></li><li><a href=#kataとは>Kataとは？</a></li></ul></nav></div></aside></main></body></html>