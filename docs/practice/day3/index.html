<!doctype html><html lang=en dir=ltr>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="3日目 # 2日目まででタスク一覧をサーバに対して要求して、レスポンスに応じてタスク一覧を画面に描画するフロントエンドができました。 ただ、現時点">
<meta name=theme-color content="#FFFFFF"><meta property="og:title" content="3日目">
<meta property="og:description" content="3日目 # 2日目まででタスク一覧をサーバに対して要求して、レスポンスに応じてタスク一覧を画面に描画するフロントエンドができました。 ただ、現時点">
<meta property="og:type" content="article">
<meta property="og:url" content="https://onebase-fujitsu.github.io/agile-dev-guide/docs/practice/day3/"><meta property="article:section" content="docs">
<title>3日目 | Fujitsu Agile Development Guide</title>
<link rel=manifest href=/agile-dev-guide/manifest.json>
<link rel=icon href=/agile-dev-guide/favicon.png type=image/x-icon>
<link rel=stylesheet href=/agile-dev-guide/book.min.958cea7827621d6fbcb3acf091344c3e44e3d2a9428f9c3c38bb9eb37bf8c45d.css integrity="sha256-lYzqeCdiHW+8s6zwkTRMPkTj0qlCj5w8OLues3v4xF0=" crossorigin=anonymous>
</head>
<body dir=ltr>
<input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control>
<main class="container flex">
<aside class=book-menu>
<div class=book-menu-content>
<nav>
<h2 class=book-brand>
<a href=/agile-dev-guide/><span>Fujitsu Agile Development Guide</span>
</a>
</h2>
<ul>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/introduction/>はじめに</a>
</li>
<li>
<input type=checkbox id=section-b077c62e2cf275f367b13c9cd484dcf6 class=toggle>
<label for=section-b077c62e2cf275f367b13c9cd484dcf6 class="flex justify-between">
<a role=button>アジャイル</a>
</label>
<ul>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/agile/manifest/>アジャイルソフトウェア開発宣言</a>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/agile/principle/>アジャイル開発12の原則</a>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/agile/conclude/>まとめ</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-488859b49087c05cd9f2afa3c2804c61 class=toggle>
<label for=section-488859b49087c05cd9f2afa3c2804c61 class="flex justify-between">
<a role=button>スクラム</a>
</label>
<ul>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/scrum/overview/>スクラムとは</a>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/scrum/roles/>ロール</a>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/scrum/products/>成果物</a>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/scrum/events/>イベント</a>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/scrum/conclude/>まとめ</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-f43a50e4d00e3398d279579a5a9a0783 class=toggle>
<label for=section-f43a50e4d00e3398d279579a5a9a0783 class="flex justify-between">
<a role=button>エクストリームプログラミング</a>
</label>
<ul>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/xp/overview/>エクストリームプログラミングとは</a>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/xp/practice/>エクストリームプログラミングのプラクティス</a>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/xp/conclude/>まとめ</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-4881c8ea96a48f6fd2540db502c204e0 class=toggle>
<label for=section-4881c8ea96a48f6fd2540db502c204e0 class="flex justify-between">
<a role=button>ソフトウェアテスト</a>
</label>
<ul>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/softwaretest/overview/>ソフトウェアテストを始めよう</a>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/softwaretest/fizzbuzz/>ウォーミングアップ</a>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/softwaretest/bowlinggame/>ボウリングゲーム</a>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/softwaretest/testdouble/>テストダブル</a>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/softwaretest/e2e/>E2Eテスト</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-6668e94793f2c3410fae208f25d1f417 class=toggle>
<label for=section-6668e94793f2c3410fae208f25d1f417 class="flex justify-between">
<a role=button>ソフトウェア設計</a>
</label>
<ul>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/softwaredesign/about/>アジャイル開発に求められるソフトウェア設計</a>
</li>
<li>
<input type=checkbox id=section-fd21b9cd7e31d8e1d2ba14b32452065e class=toggle>
<label for=section-fd21b9cd7e31d8e1d2ba14b32452065e class="flex justify-between">
<a role=button>SOLID原則</a>
</label>
<ul>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/softwaredesign/solidprinciple/srp/>単一責任の原則(SRP)</a>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/softwaredesign/solidprinciple/ocp/>オープン・クローズドの原則(OCP)</a>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/softwaredesign/solidprinciple/lsp/>リスコフの置換原則(LSP)</a>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/softwaredesign/solidprinciple/dip/>依存性逆転の原則(DIP)</a>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/softwaredesign/solidprinciple/isp/>インターフェース分離の原則(ISP)</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-ee4c81ada0b6a9ee859cebeab00ca76e class=toggle>
<label for=section-ee4c81ada0b6a9ee859cebeab00ca76e class="flex justify-between">
<a role=button>デザインパターン</a>
</label>
<ul>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/softwaredesign/designpattern/designpattern/>デザインパターン</a>
</li>
</ul>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-a16dbb8fa8b2df15e7da65eb13e2d51a class=toggle checked>
<label for=section-a16dbb8fa8b2df15e7da65eb13e2d51a class="flex justify-between">
<a role=button>アジャイルの実践</a>
</label>
<ul>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/practice/day1/>1日目</a>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/practice/day2/>2日目</a>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/practice/day3/ class=active>3日目</a>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/practice/day4/>4日目</a>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/practice/day5/>5日目</a>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/practice/day6/>6日目</a>
</li>
</ul>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/inclosing/>おわりに</a>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/recommendedbooks/>推奨書籍</a>
</li>
<li class=book-section-flat>
<span>全体編</span>
<ul>
<li>
<input type=checkbox id=section-e99c955bf75208a72cc409dac3a52e06 class=toggle>
<label for=section-e99c955bf75208a72cc409dac3a52e06 class="flex justify-between">
<a role=button>リーンスタートアップ</a>
</label>
<ul>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/framework/leanstartup/scoping/>スコーピング</a>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/framework/leanstartup/product/>プロダクトビジョン / バリュープロポジション</a>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/framework/leanstartup/persona/>ペルソナエコシステム</a>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/framework/leanstartup/userstory/>ユーザーストーリーマッピング</a>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/framework/leanstartup/risk/>ペルソナエコシステム</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-9be0117e86ea19505cc5ceb0d72e959e class=toggle>
<label for=section-9be0117e86ea19505cc5ceb0d72e959e class="flex justify-between">
<a role=button>モダナイゼーション</a>
</label>
<ul>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/framework/modernization/overview/>モダナイゼーションの流れ</a>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/framework/modernization/organization/>体制・役割</a>
</li>
<li>
<input type=checkbox id=section-bde04692c1fd3ecde39ac4bab024fff3 class=toggle>
<label for=section-bde04692c1fd3ecde39ac4bab024fff3 class="flex justify-between">
<a role=button>Swift Method</a>
</label>
<ul>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/framework/modernization/swift/overview/>Swift Method とは</a>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/framework/modernization/swift/eventstorming/>Event Storming</a>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/framework/modernization/swift/boris/>Boris</a>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/framework/modernization/swift/snape/>SnapE</a>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/framework/modernization/swift/slices/>Slices</a>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/framework/modernization/swift/techchoice/>Tech Choice</a>
</li>
</ul>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/framework/modernization/inception/>Inception</a>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/framework/modernization/outception/>Outception</a>
</li>
</ul>
</li>
</ul>
</li>
<li class=book-section-flat>
<span>Team編</span>
<ul>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/team/workstyle/>チームの働き方</a>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/team/balancedteam/>バランスチーム</a>
</li>
<li>
<input type=checkbox id=section-567421c4f32cd12e88a451ff3fc3c989 class=toggle>
<label for=section-567421c4f32cd12e88a451ff3fc3c989 class="flex justify-between">
<a role=button>マインドセット</a>
</label>
<ul>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/team/mindset/onebase/>ONEbaseの価値観</a>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/team/mindset/psychologicalsafety/>心理的安全性</a>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/team/mindset/xp/>XPの価値観</a>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/team/mindset/practice/>プラクティスの取り入れ方</a>
</li>
</ul>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/team/teambuilding/>チームビルディング</a>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/team/remotework/>リモートワーク</a>
</li>
<li>
<input type=checkbox id=section-b52b30221e4a89615e78dbb78082bc47 class=toggle>
<label for=section-b52b30221e4a89615e78dbb78082bc47 class="flex justify-between">
<a role=button>チームのアクティビティ</a>
</label>
<ul>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/team/activities/officestandup/>全体スタンドアップ</a>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/team/activities/teamstandup/>チームスタンドアップ</a>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/team/activities/preipm/>Pre-IPM</a>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/team/activities/ipm/>IPM</a>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/team/activities/cl/>CLミーティング</a>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/team/activities/retro/>レトロスペクティブ</a>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/team/activities/salesmeeting/>営業確認会議</a>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/team/activities/internalsync/>Internal Sync</a>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/team/activities/riskmitigations/>Risks & Mitigations</a>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/team/activities/feedback/>フィードバック</a>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/team/activities/icebreak/>Ice Break</a>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/team/activities/teamhealthcheck/>Team Health Check</a>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/team/activities/1on1/>1on1</a>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/team/activities/exercise/>ラジオ体操</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-0ca98ed05d635a669132a6c12086bd7c class=toggle>
<label for=section-0ca98ed05d635a669132a6c12086bd7c class="flex justify-between">
<a role=button>チームのプラクティス</a>
</label>
<ul>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/team/practices/facilitation/>ファシリテーション</a>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/team/practices/okrs/>OKRs</a>
</li>
</ul>
</li>
</ul>
</li>
<li class=book-section-flat>
<span>Designer編</span>
<ul>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/designer/overview/>Designerとは</a>
</li>
<li>
<input type=checkbox id=section-0356f56143a8f1215a9a8d2120898187 class=toggle>
<label for=section-0356f56143a8f1215a9a8d2120898187 class="flex justify-between">
<a role=button>Designerのプラクティス</a>
</label>
<ul>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/designer/practices/persona/>ペルソナ</a>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/designer/practices/scenario/>シナリオ</a>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/designer/practices/researchplanning/>リサーチ計画立案</a>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/designer/practices/prototyping/>プロトタイピング</a>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/designer/practices/script/>スクリプト作成</a>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/designer/practices/researchacction/>リサーチ実施</a>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/designer/practices/synthesize/>シンセサイズ</a>
</li>
</ul>
</li>
</ul>
</li>
<li class=book-section-flat>
<span>ProductManager編</span>
<ul>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/productmanager/overview/>ProductManagerとは</a>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/productmanager/productroadmap/>プロダクトロードマップ</a>
</li>
<li>
<input type=checkbox id=section-6976e7caed46c8d93d6db8fc8ac10964 class=toggle>
<label for=section-6976e7caed46c8d93d6db8fc8ac10964 class="flex justify-between">
<a role=button>ProductManagerのプラクティス</a>
</label>
<ul>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/productmanager/practices/mvp/>MVP</a>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/productmanager/practices/userstorymapping/>ユーザーストーリーマッピング</a>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/productmanager/practices/userstory/>ユーザーストーリー</a>
</li>
</ul>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/productmanager/userstory/>ユーザストーリーマッピング</a>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/productmanager/equipmentprioritization/>機器の優先順位付け</a>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/productmanager/backlogmanagement/>バックログ管理</a>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/productmanager/releaseplanning/>リリース管理</a>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/productmanager/informationsharing/>情報共有</a>
</li>
</ul>
</li>
<li class=book-section-flat>
<span>Developer編</span>
<ul>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/developer/overview/>Developerとは</a>
</li>
<li>
<input type=checkbox id=section-8663d063f439d3f63d1a0dffad20b22d class=toggle>
<label for=section-8663d063f439d3f63d1a0dffad20b22d class="flex justify-between">
<a role=button>Developerのプラクティス</a>
</label>
<ul>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/developer/practices/tdd/>TDD</a>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/developer/practices/cicd/>CI/CD</a>
</li>
<li>
<a href=https://onebase-fujitsu.github.io/agile-dev-guide/docs/developer/practices/pairprogramming/>ペアプログラミング</a>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
<script>(function(){var a=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(b){localStorage.setItem("menu.scrollTop",a.scrollTop)}),a.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>
</div>
</aside>
<div class=book-page>
<header class=book-header>
<div class="flex align-center justify-between">
<label for=menu-control>
<img src=/agile-dev-guide/svg/menu.svg class=book-icon alt=Menu>
</label>
<strong>3日目</strong>
<label for=toc-control>
<img src=/agile-dev-guide/svg/toc.svg class=book-icon alt="Table of Contents">
</label>
</div>
<aside class="hidden clearfix">
<nav id=TableOfContents>
<ul>
<li><a href=#バックエンドの初期設定>バックエンドの初期設定</a>
<ul>
<li><a href=#spring-initializr>Spring Initializr</a></li>
<li><a href=#dbの設定>DBの設定</a></li>
<li><a href=#dbのマイグレーションツールの導入>DBのマイグレーションツールの導入</a></li>
</ul>
</li>
<li><a href=#get-todosの実装>GET /todosの実装</a>
<ul>
<li><a href=#get-todosのテスト>GET /todosのテスト</a></li>
<li><a href=#get-todosの実装-1>GET /todosの実装</a></li>
</ul>
</li>
<li><a href=#クライアントとサーバの連携>クライアントとサーバの連携</a></li>
</ul>
</nav>
</aside>
</header>
<article class=markdown><h1 id=3日目>
3日目
<a class=anchor href=#3%e6%97%a5%e7%9b%ae>#</a>
</h1>
<p>2日目まででタスク一覧をサーバに対して要求して、レスポンスに応じてタスク一覧を画面に描画するフロントエンドができました。
ただ、現時点でリクエストに対して応答するバックエンドがまだありませんので、これを作っていきましょう。</p>
<h2 id=バックエンドの初期設定>
バックエンドの初期設定
<a class=anchor href=#%e3%83%90%e3%83%83%e3%82%af%e3%82%a8%e3%83%b3%e3%83%89%e3%81%ae%e5%88%9d%e6%9c%9f%e8%a8%ad%e5%ae%9a>#</a>
</h2>
<h3 id=spring-initializr>
Spring Initializr
<a class=anchor href=#spring-initializr>#</a>
</h3>
<p>Spring Bootのプロジェクトを作成するときは <a href=https://start.spring.io/>Spring Initializr</a> を使います。</p>
<p><img src=SpringInitializr.jpg alt="Spring Initializr"></p>
<p>今回はGradle Projectで開発言語はKotlinにします。</p>
<p>Spring Bootのバージョンはその時の安定版を指定すると良いです。</p>
<p>Artifact名は今回はtodo-app-serverとしました。
依存ライブラリですが、後からでも追加できますので、ここではいったん、Spring Webのみ追加しました。</p>
<p>これでGenerateしましょう。雛形となるプロジェクトがダウンロードされるはずです。</p>
<h3 id=dbの設定>
DBの設定
<a class=anchor href=#db%e3%81%ae%e8%a8%ad%e5%ae%9a>#</a>
</h3>
<p>例によってアプリ作成は初期設定が一番大変です。頑張っていきましょう。
まず、DBの設定をしていきましょう。</p>
<p>今回DBは <a href=https://www.postgresql.org/>PostgreSQL</a> を使用しようと思います。
ソフトウェアテストの章でつかったサンプルアプリケーションではH2をインメモリで動かしていたのですが、
流石に実際の開発のときにそんなことはしないので、実際の開発に寄せる意味でもPostgreSQLにしてみます。</p>
<p>まだPostgreSQLをインストールしていない方はPostgreSQLを導入してください。</p>
<p>PostgreSQLをサービスとしてローカルで動いているのを確認したら、
<a href=https://www.postgresql.jp/document/9.4/html/app-createdb.html>createdb</a> コマンドを実行してtodo_dbを作っておきましょう。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>createdb todo_db
</code></pre></div><p>まず、DB接続に必要なライブラリを追加しましょう。build.gradle.ktsを開いたらdependenciesを以下のように変更してください。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#75715e>// build.gradle.kts
</span><span style=color:#75715e></span>dependencies {
    implementation(<span style=color:#e6db74>&#34;org.springframework.boot:spring-boot-starter-web&#34;</span>)
    implementation(<span style=color:#e6db74>&#34;com.fasterxml.jackson.module:jackson-module-kotlin&#34;</span>)
    implementation(<span style=color:#e6db74>&#34;org.jetbrains.kotlin:kotlin-reflect&#34;</span>)
    implementation(<span style=color:#e6db74>&#34;org.jetbrains.kotlin:kotlin-stdlib-jdk8&#34;</span>)
    implementation(<span style=color:#e6db74>&#34;org.springframework.boot:spring-boot-starter-jdbc&#34;</span>)   <span style=color:#75715e>// 追記
</span><span style=color:#75715e></span>    runtimeOnly(<span style=color:#e6db74>&#34;org.postgresql:postgresql&#34;</span>)                              <span style=color:#75715e>// 追記
</span><span style=color:#75715e></span>    testImplementation(<span style=color:#e6db74>&#34;org.springframework.boot:spring-boot-starter-test&#34;</span>)
}
</code></pre></div><p>次にsrc/resources/application.propertiesがありますが、yamlで記述したほうが見通しが良くなるので、
このapplication.propertiesをapplication.ymlに変更します。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#ae81ff>// application.yml</span>
<span style=color:#f92672>spring</span>:
  <span style=color:#f92672>datasource</span>:
    <span style=color:#f92672>url</span>: <span style=color:#ae81ff>jdbc:postgresql://localhost:5432/${DB_NAME:todo_db}</span>
    <span style=color:#f92672>username</span>: <span style=color:#ae81ff>onebase</span>
    <span style=color:#f92672>password</span>:
</code></pre></div><p>設定ファイルはこのように変更します。<strong>usernameは<code>createdb</code>コマンドを実行した環境に依存しますので、皆様の環境に合わせて書き換えてください。</strong>
この状態でアプリケーションを起動してみましょう。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>./gradlew bootRun
</code></pre></div><pre tabindex=0><code>onebase@Onebase-Maguro todo-app-server % ./gradlew bootRun

&gt; Task :bootRun

  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::                (v2.5.4)

2021-09-12 04:38:21.169  INFO 74012 --- [           main] c.f.t.TodoAppServerApplicationKt         : Starting TodoAppServerApplicationKt using Java 13.0.2 on Onebase-Maguro.local with PID 74012 (/Users/onebase/IdeaProjects/todo-app-server/build/classes/kotlin/main started by onebase in /Users/onebase/IdeaProjects/todo-app-server)
2021-09-12 04:38:21.171  INFO 74012 --- [           main] c.f.t.TodoAppServerApplicationKt         : No active profile set, falling back to default profiles: default
2021-09-12 04:38:22.054  INFO 74012 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8080 (http)
2021-09-12 04:38:22.063  INFO 74012 --- [           main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2021-09-12 04:38:22.064  INFO 74012 --- [           main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.52]
2021-09-12 04:38:22.122  INFO 74012 --- [           main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2021-09-12 04:38:22.122  INFO 74012 --- [           main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 910 ms
2021-09-12 04:38:22.451  INFO 74012 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8080 (http) with context path ''
2021-09-12 04:38:22.459  INFO 74012 --- [           main] c.f.t.TodoAppServerApplicationKt         : Started TodoAppServerApplicationKt in 1.844 seconds
&lt;==========---&gt; 83% EXECUTING [16s]
&gt; :bootRun

</code></pre><p>ひとまずこのような表示が出たらServerとPostgreSQL DBの接続はうまくいっていますので、<code>Control+C</code>を押してサーバを止めておきましょう。</p>
<h3 id=dbのマイグレーションツールの導入>
DBのマイグレーションツールの導入
<a class=anchor href=#db%e3%81%ae%e3%83%9e%e3%82%a4%e3%82%b0%e3%83%ac%e3%83%bc%e3%82%b7%e3%83%a7%e3%83%b3%e3%83%84%e3%83%bc%e3%83%ab%e3%81%ae%e5%b0%8e%e5%85%a5>#</a>
</h3>
<p>DBのマイグレーションツールを導入してみましょう。
先程<code>createdb</code>コマンドを実行してDBを作りましたが、まだテーブルを全く作ってません。
DBのスキーマを手動で管理するのはメチャクチャ大変ですので、マイグレーションツールを導入するとスキーマの作成や、スキーマ変更に伴うデータのマイグレーションを自動化することができます。</p>
<p>ここでは <a href=https://flywaydb.org/>Flyway</a> を使います。</p>
<p>再び、build.gradle.ktsを開いたら以下の依存を追加してください。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#75715e>// build.gradle.kts
</span><span style=color:#75715e></span>dependencies {
	implementation(<span style=color:#e6db74>&#34;org.springframework.boot:spring-boot-starter-jdbc&#34;</span>)
	implementation(<span style=color:#e6db74>&#34;org.springframework.boot:spring-boot-starter-web&#34;</span>)
	implementation(<span style=color:#e6db74>&#34;com.fasterxml.jackson.module:jackson-module-kotlin&#34;</span>)
	implementation(<span style=color:#e6db74>&#34;org.jetbrains.kotlin:kotlin-reflect&#34;</span>)
	implementation(<span style=color:#e6db74>&#34;org.jetbrains.kotlin:kotlin-stdlib-jdk8&#34;</span>)
	implementation(<span style=color:#e6db74>&#34;org.flywaydb:flyway-core&#34;</span>)                       <span style=color:#75715e>// 追記
</span><span style=color:#75715e></span>	runtimeOnly(<span style=color:#e6db74>&#34;org.postgresql:postgresql&#34;</span>)
	testImplementation(<span style=color:#e6db74>&#34;org.springframework.boot:spring-boot-starter-test&#34;</span>)
}
</code></pre></div><p>次に、src/main/resources/application.ymlを再び開いてFlywayの設定を記入しましょう。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#ae81ff>// application.yml</span>
<span style=color:#f92672>spring</span>:
  <span style=color:#f92672>datasource</span>:
    <span style=color:#f92672>url</span>: <span style=color:#ae81ff>jdbc:postgresql://localhost:5432/${DB_NAME:todo_db}</span>
    <span style=color:#f92672>username</span>: <span style=color:#ae81ff>onebase</span>
    <span style=color:#f92672>password</span>:
  <span style=color:#f92672>flyway</span>:
    <span style=color:#f92672>baseline-on-migrate</span>: <span style=color:#66d9ef>true</span>
    <span style=color:#f92672>url</span>: <span style=color:#ae81ff>jdbc:postgresql://localhost:5432/${DB_NAME:todo_db}</span>
    <span style=color:#f92672>user</span>: <span style=color:#ae81ff>onebase</span>
    <span style=color:#f92672>password</span>:
</code></pre></div><p>これでFlywayを使う準備が整いました。では実際にマイグレーションをかけてテーブルを作ってみましょう。
src/main/resources配下にdbというディレクトリを作成し、さらにその配下にmigrationというディレクトリを作成します。
そして、そのmigration配下に<code>VyyyyMMddHHmmss__CreateTodoTable.sql</code>というファイルを新規に作ってください。
&lsquo;yyyyMMddHHmmss&rsquo;の部分は実際に作成作業をした時間に置き換えてください。
ファイル名がこの命名規約に従っていることがとても大事です。</p>
<pre tabindex=0><code>src
├── main
│     ├── kotlin
│     │     └── com
│     │         └── fujitsu
│     │             └── todoappserver
│     │                 └── TodoAppServerApplication.kt
│     └── resources
│         ├── application.yml
│         ├── db
│         │     └── migration
│         │         └── V20210912045400__CreateTodoTable.sql
│         ├── static
│         └── templates
└── test
    └── kotlin
        └── com
            └── fujitsu
                └── todoappserver
                    └── TodoAppServerApplicationTests.kt

</code></pre><p>筆者の例では「V20210912045400__CreateTodoTable.sql」というファイル名にしています。（このドキュメントは朝4時に書いています。）</p>
<p>このファイルにはマイグレーション用のSQLを記述します。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#66d9ef>create</span> <span style=color:#66d9ef>table</span> todo (
    id serial <span style=color:#66d9ef>primary</span> <span style=color:#66d9ef>key</span>,
    title varchar <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>null</span>,
    completed boolean <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>null</span> <span style=color:#66d9ef>default</span> <span style=color:#66d9ef>false</span>
);
</code></pre></div><p>最初のSQLはこのようにしました。
この状態で再度アプリケーションを起動してみましょう。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>./gradlew bootRun
</code></pre></div><p>正常に起動したら、どのようなツールでも構いませんのでtodo_dbの状態をみてみましょう。</p>
<p><img src=flyway_migration.jpg alt="flyway migration"></p>
<p>flyway_schema_historyというテーブル共にtodoテーブルがFlywayによって作られていたら成功です。
Flywayはアプリケーション起動時にdb/migrationディレクトリ配下のSQLを確認して、DBのマイグレーションを実行してくれます。</p>
<p>これでバックエンド開発の下準備が整いました。ここまでのソースコードは
<a href=https://github.com/Onebase-Fujitsu/todo-app-server/tree/step1>https://github.com/Onebase-Fujitsu/todo-app-server/tree/step1</a>
に置いてあります。</p>
<h2 id=get-todosの実装>
GET /todosの実装
<a class=anchor href=#get-todos%e3%81%ae%e5%ae%9f%e8%a3%85>#</a>
</h2>
<h3 id=get-todosのテスト>
GET /todosのテスト
<a class=anchor href=#get-todos%e3%81%ae%e3%83%86%e3%82%b9%e3%83%88>#</a>
</h3>
<p>ではまず/todosに対してGETをしたときに、データベースにアクセスして、Todo一覧をJSON形式で返却するテストを書いてみましょう。
src/test/kotlin/com.fujitsu.todoappserver配下にcontrollerパッケージを作り、その中に<code>TodoApiControllerTest.kt</code>を作りましょう</p>
<pre tabindex=0><code>src
├── main
│     ├── kotlin
│     │     └── com
│     │         └── fujitsu
│     │             └── todoappserver
│     │                 └── TodoAppServerApplication.kt
│     └── resources
│         ├── application.yml
│         ├── db
│         │     └── migration
│         │         └── V20210912045400__CreateTodoTable.sql
│         ├── static
│         └── templates
└── test
    └── kotlin
        └── com
            └── fujitsu
                └── todoappserver
                    ├── TodoAppServerApplicationTests.kt
                    └── controller
                        └── TodoApiControllerTest.kt    // 作成

</code></pre><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#75715e>// TodoApiControllerTest.kt
</span><span style=color:#75715e></span><span style=color:#66d9ef>package</span> com.fujitsu.todoappserver.controller

<span style=color:#66d9ef>import</span> com.fasterxml.jackson.module.kotlin.jacksonObjectMapper
<span style=color:#66d9ef>import</span> com.fasterxml.jackson.module.kotlin.readValue
<span style=color:#66d9ef>import</span> org.assertj.core.api.Assertions
<span style=color:#66d9ef>import</span> org.junit.jupiter.api.Test
<span style=color:#66d9ef>import</span> org.springframework.beans.factory.annotation.Autowired
<span style=color:#66d9ef>import</span> org.springframework.boot.test.context.SpringBootTest
<span style=color:#66d9ef>import</span> org.springframework.boot.test.web.client.TestRestTemplate
<span style=color:#66d9ef>import</span> org.springframework.http.*

<span style=color:#a6e22e>@SpringBootTest</span>(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)
<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>TodoApiControllerTest</span> {
    <span style=color:#a6e22e>@Autowired</span>
    <span style=color:#66d9ef>lateinit</span> <span style=color:#66d9ef>var</span> restTemplate: TestRestTemplate

    <span style=color:#a6e22e>@Test</span>
    <span style=color:#66d9ef>fun</span> <span style=color:#960050;background-color:#1e0010>タスク一覧を取得できる()</span> <span style=color:#960050;background-color:#1e0010>{</span>
        <span style=color:#a6e22e>val</span> header = HttpHeaders()
        header.contentType = MediaType.APPLICATION_JSON
        <span style=color:#66d9ef>val</span> response = restTemplate.exchange(<span style=color:#e6db74>&#34;/todos&#34;</span>, HttpMethod.GET, HttpEntity(<span style=color:#66d9ef>null</span>, header), String<span style=color:#f92672>::</span><span style=color:#66d9ef>class</span>.java)
        <span style=color:#66d9ef>val</span> mapper = jacksonObjectMapper()
        <span style=color:#66d9ef>val</span> articles: List&lt;Todo&gt; = mapper.readValue(response.body<span style=color:#f92672>!!</span>)
        Assertions.assertThat(response.statusCode).isEqualTo(HttpStatus.OK)
        Assertions.assertThat(articles.size).isEqualTo(<span style=color:#ae81ff>0</span>)
    }
}
</code></pre></div><p>最初のテストはこのように書きました。ソフトウェアテストの章でこのあたりは詳しく説明していますので、テストの説明は割愛します。
このテストは当然Todoがまだ定義されてませんのでコンパイルができずに失敗します。</p>
<h3 id=get-todosの実装-1>
GET /todosの実装
<a class=anchor href=#get-todos%e3%81%ae%e5%ae%9f%e8%a3%85-1>#</a>
</h3>
<h4 id=modelの実装>
Modelの実装
<a class=anchor href=#model%e3%81%ae%e5%ae%9f%e8%a3%85>#</a>
</h4>
<p>まず先のテストはTodoモデルが無いことで落ちていたので、これを定義しましょう。</p>
<p>src/main/kotlin/com.fujitsu.todoappserver配下に<code>model</code>パッケージ、<code>controller</code>パッケージ、<code>service</code>パッケージ、<code>repository</code>パッケージを作りましょう。
そして<code>model</code>パッケージ配下にTodo.ktを作成。</p>
<pre tabindex=0><code>src
├── main
│     ├── kotlin
│     │     └── com
│     │         └── fujitsu
│     │             └── todoappserver
│     │                 ├── TodoAppServerApplication.kt
│     │                 ├── controller
│     │                 ├── model
│     │                 │     └── Todo.kt       // 作成
│     │                 ├── repository
│     │                 └── service
│     └── resources
│         ├── application.yml
│         ├── db
│         │     └── migration
│         │         └── V20210912045400__CreateTodoTable.sql
│         ├── static
│         └── templates
└── test
    └── kotlin
        └── com
            └── fujitsu
                └── todoappserver
                    ├── TodoAppServerApplicationTests.kt
                    └── controller
                        └── TodoControllerTest.kt

</code></pre><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#75715e>// Todo.kt
</span><span style=color:#75715e></span><span style=color:#66d9ef>package</span> com.fujitsu.todoappserver.model

<span style=color:#66d9ef>data</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Todo</span>(
    <span style=color:#66d9ef>val</span> id: Int,
    <span style=color:#66d9ef>val</span> title: String,
    <span style=color:#66d9ef>val</span> completed: Boolean
)
</code></pre></div><p>Kotlinはdata classの宣言で簡単にPOJOを作ることができます。Javaだと必要なsetterやgetterは不要です。
このTodoモデルを先ほど作成したテストにインポートして実行してみましょう。</p>
<p>コンパイルには成功して、Getリクエストが発生していますが、404 Not Foundが返却されるようになりテストが失敗するようになったと思います。</p>
<h4 id=controller層の実装>
Controller層の実装
<a class=anchor href=#controller%e5%b1%a4%e3%81%ae%e5%ae%9f%e8%a3%85>#</a>
</h4>
<p>Controller層を実装していきましょう。controllerパッケージ配下にTodoControllerInterface.ktとTodoController.ktを作成します。</p>
<p>TodoControllerInterfaceにはTodoControllerが使いたい（つまりServiceに実装してもらいたい）メソッドを定義しておきます。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#75715e>// TodoControllerInterface.kt
</span><span style=color:#75715e></span><span style=color:#66d9ef>package</span> com.fujitsu.todoappserver.controller

<span style=color:#66d9ef>import</span> com.fujitsu.todoappserver.model.Todo

<span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>TodoControllerInterface</span> {
    <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>getTodos</span>(): List&lt;Todo&gt;
}
</code></pre></div><p>TodoControllerは先程定義したInterfaceを通じてserviceを利用します。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#75715e>// TodoController.kt
</span><span style=color:#75715e></span><span style=color:#66d9ef>package</span> com.fujitsu.todoappserver.controller

<span style=color:#66d9ef>import</span> com.fujitsu.todoappserver.model.Todo
<span style=color:#66d9ef>import</span> org.springframework.http.HttpStatus
<span style=color:#66d9ef>import</span> org.springframework.web.bind.annotation.GetMapping
<span style=color:#66d9ef>import</span> org.springframework.web.bind.annotation.ResponseStatus
<span style=color:#66d9ef>import</span> org.springframework.web.bind.annotation.RestController

<span style=color:#a6e22e>@RestController</span>
<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>TodoController</span>(<span style=color:#66d9ef>private</span> <span style=color:#66d9ef>val</span> todoService: TodoControllerInterface) {
    <span style=color:#a6e22e>@GetMapping</span>(<span style=color:#e6db74>&#34;/todos&#34;</span>)
    <span style=color:#a6e22e>@ResponseStatus</span>(HttpStatus.OK)
    <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>getTodos</span>() : List&lt;Todo&gt; {
        <span style=color:#66d9ef>return</span> todoService.getTodos()
    }
}
</code></pre></div><p>InterfaceがService層ではなくController層にあるのに違和感を覚える人も多いと思います。
これは依存性逆転の原則(DIP)です。覚えてますでしょうか？
依存性逆転の原則では<strong>抽象の所有権も逆転</strong>させるんでしたよね。</p>
<h4 id=service層の実装>
Service層の実装
<a class=anchor href=#service%e5%b1%a4%e3%81%ae%e5%ae%9f%e8%a3%85>#</a>
</h4>
<p>同様にService層も実装していきましょう。Serviceパッケージ配下にTodoServiceInterface.ktとTodoService.ktを作ります。
Service層はRepository層から返ってきたレスポンスをそのままControllerに受け流すだけになるので、説明は割愛します。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#75715e>// TodoServiceInterface.kt
</span><span style=color:#75715e></span><span style=color:#66d9ef>package</span> com.fujitsu.todoappserver.service

<span style=color:#66d9ef>import</span> com.fujitsu.todoappserver.model.Todo

<span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>TodoServiceInterface</span> {
    <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>getTodos</span>(): List&lt;Todo&gt;
}
</code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#75715e>// TodoService.kt
</span><span style=color:#75715e></span><span style=color:#66d9ef>package</span> com.fujitsu.todoappserver.service

<span style=color:#66d9ef>import</span> com.fujitsu.todoappserver.controller.TodoControllerInterface
<span style=color:#66d9ef>import</span> com.fujitsu.todoappserver.model.Todo
<span style=color:#66d9ef>import</span> org.springframework.stereotype.Service

<span style=color:#a6e22e>@Service</span>
<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>TodoService</span>(<span style=color:#66d9ef>private</span> <span style=color:#66d9ef>val</span> todoRepository: TodoServiceInterface): TodoControllerInterface {
    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>getTodos</span>(): List&lt;Todo&gt; {
        <span style=color:#66d9ef>return</span> todoRepository.getTodos()
    }
}
</code></pre></div><h4 id=repository層の実装>
Repository層の実装
<a class=anchor href=#repository%e5%b1%a4%e3%81%ae%e5%ae%9f%e8%a3%85>#</a>
</h4>
<p>Repository層を実装します。repositoryパッケージ配下にTodoRepository.ktを作成し、TodoServiceInterfaceを実装しましょう。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#75715e>// TodoRepository.kt
</span><span style=color:#75715e></span><span style=color:#66d9ef>package</span> com.fujitsu.todoappserver.repository

<span style=color:#66d9ef>import</span> com.fujitsu.todoappserver.model.Todo
<span style=color:#66d9ef>import</span> com.fujitsu.todoappserver.service.TodoServiceInterface
<span style=color:#66d9ef>import</span> org.springframework.jdbc.core.JdbcTemplate
<span style=color:#66d9ef>import</span> org.springframework.stereotype.Repository
<span style=color:#66d9ef>import</span> java.sql.ResultSet

<span style=color:#a6e22e>@Repository</span>
<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>TodoRepository</span>(<span style=color:#66d9ef>val</span> jdbcTemplate: JdbcTemplate) : TodoServiceInterface {
    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>getTodos</span>(): List&lt;Todo&gt; {
        <span style=color:#66d9ef>return</span> jdbcTemplate.query(
            <span style=color:#e6db74>&#34;&#34;&#34;select id, title, completed from todo&#34;&#34;&#34;</span>
        ) {rs: ResultSet, _:Int <span style=color:#f92672>-&gt;</span>
            Todo(rs.getInt(<span style=color:#e6db74>&#34;id&#34;</span>),
                rs.getString(<span style=color:#e6db74>&#34;title&#34;</span>),
                rs.getBoolean(<span style=color:#e6db74>&#34;completed&#34;</span>)
            )
        }
    }
}
</code></pre></div><p>Repositoryは実際にDBに対してクエリを投げ、ResultSetからTodoオブジェクトを作り、それをListとして返しています。
これで実装は終わりました。テストを実行してみましょう！</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>./gradlew test
</code></pre></div><pre tabindex=0><code>onebase@Onebase-Maguro todo-app-server % ./gradlew test

&gt; Task :test
2021-09-12 06:37:05.404  INFO 76511 --- [ionShutdownHook] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown initiated...
2021-09-12 06:37:05.408  INFO 76511 --- [ionShutdownHook] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown completed.

BUILD SUCCESSFUL in 4s
4 actionable tasks: 1 executed, 3 up-to-date

</code></pre><p>テストが通る様子が確認できると思います。</p>
<p>ここまでのソースは
<a href=https://github.com/Onebase-Fujitsu/todo-app-server/tree/step2>https://github.com/Onebase-Fujitsu/todo-app-server/tree/step2</a>
に置いてあります。</p>
<h2 id=クライアントとサーバの連携>
クライアントとサーバの連携
<a class=anchor href=#%e3%82%af%e3%83%a9%e3%82%a4%e3%82%a2%e3%83%b3%e3%83%88%e3%81%a8%e3%82%b5%e3%83%bc%e3%83%90%e3%81%ae%e9%80%a3%e6%90%ba>#</a>
</h2>
<p>さて、サーバを起動した状態にしておいてください。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>./gradlew bootRun
</code></pre></div><p>サーバを起動した状態でクライアントを起動しましょう。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>npm run start
</code></pre></div><p>その状態で <a href=http://localhost:3000>http://localhost:3000</a> にアクセスすると、まだ、/todosに対するリクエストに404が返っていると思います。</p>
<p><img src=getTodos404.jpg alt=404></p>
<p>それもそのはず、Clientはlocalhost:3000/todosにリクエストしている一方で、サーバは8080ポートで起動しているからです。
そこでClientにProxyの設定を入れてあげます。</p>
<p>Clientのpackage.jsonを開いたら一行<code>"proxy": "http://localhost:8080",</code>という設定を追記して、再度Clientを起動してみましょう。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=color:#960050;background-color:#1e0010>package.json</span>
{
  <span style=color:#960050;background-color:#1e0010>...</span>
  <span style=color:#f92672>&#34;proxy&#34;</span>: <span style=color:#e6db74>&#34;http://localhost:8080&#34;</span>,
  <span style=color:#960050;background-color:#1e0010>...</span>
}
</code></pre></div><p><img src=getTodos200.jpg alt=200></p>
<p>proxyの設定によりServerが応答できるようになり、200が返却されているのが確認できると思います。</p>
<p>おめでとうございまいます！最初のサーバAPIとクライアントを連携させたアプリケーションを実装することができました！</p>
<hr>
<p>4日目に続きます</p>
<a href=/agile-dev-guide/docs/practice/day4/ class=book-btn>
4日目
</a>
</article>
<footer class=book-footer>
<div class="flex flex-wrap justify-between">
</div>
<script>(function(){function a(c){const a=window.getSelection(),b=document.createRange();b.selectNodeContents(c),a.removeAllRanges(),a.addRange(b)}document.querySelectorAll("pre code").forEach(b=>{b.addEventListener("click",function(c){a(b.parentElement),navigator.clipboard&&navigator.clipboard.writeText(b.parentElement.textContent)})})})()</script>
</footer>
<div class=book-comments>
</div>
<label for=menu-control class="hidden book-menu-overlay"></label>
</div>
<aside class=book-toc>
<div class=book-toc-content>
<nav id=TableOfContents>
<ul>
<li><a href=#バックエンドの初期設定>バックエンドの初期設定</a>
<ul>
<li><a href=#spring-initializr>Spring Initializr</a></li>
<li><a href=#dbの設定>DBの設定</a></li>
<li><a href=#dbのマイグレーションツールの導入>DBのマイグレーションツールの導入</a></li>
</ul>
</li>
<li><a href=#get-todosの実装>GET /todosの実装</a>
<ul>
<li><a href=#get-todosのテスト>GET /todosのテスト</a></li>
<li><a href=#get-todosの実装-1>GET /todosの実装</a></li>
</ul>
</li>
<li><a href=#クライアントとサーバの連携>クライアントとサーバの連携</a></li>
</ul>
</nav>
</div>
</aside>
</main>
</body>
</html>